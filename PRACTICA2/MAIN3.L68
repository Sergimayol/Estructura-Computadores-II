000018D6 Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 10/01/2022 12:28:26

00000000                             1  ; =============================================================================
00000000                             2  ; TITLE    : GAME OF LIFE APPLICATION
00000000                             3  ; AUTHOR   : ANTONI BURGUERA
00000000                             4  ; CREATION : 05-JULY-2021
00000000                             5  ; =============================================================================
00000000                             6  
00001000                             7              ORG     $1000
00001000                             8  
00001000                             9  ; --- CODE INCLUDES -----------------------------------------------------------
00001000                            10  
00001000                            11              INCLUDE "SYSCONST.X68"          ; SYSTEM CONSTANTS
00001000                            12  ; =============================================================================
00001000                            13  ; TITLE    : SYSTEM CONSTANTS
00001000                            14  ; AUTHOR   : ANTONI BURGUERA
00001000                            15  ; HISTORY  : 05-JULY-2021 - CREATION
00001000                            16  ; COMMENTS : * MOUVAL AND MOUEDGE FORMAT IS AS FOLLOWS:
00001000                            17  ;              +---+---+---+---+---+---+---+---+
00001000                            18  ;              | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
00001000                            19  ;              +---+---+---+---+---+---+---+---+
00001000                            20  ;              \-------------------/ |   |   |
00001000                            21  ;                        |           |   |   +-- LEFT MOUSE BUTTON
00001000                            22  ;                        |           |   +------ RIGHT MOUSE BUTTON
00001000                            23  ;                        |           +---------- CENTRAL MOUSE BUTTON
00001000                            24  ;                        +---------------------- 0
00001000                            25  ;              A "1" IN ONE OF THESE BITS IN MOUVAL MEANS "BUTTON PRESSED".
00001000                            26  ;              A "0" IN ONE OF THESE BITS IN MOUVAL MEANS "BUTTON NOT PRESSED".
00001000                            27  ;              A "1" IN ONE OF THESE BITS IN MOUEDGE MEANS "BUTTON CLICKED".
00001000                            28  ;              A "0" IN ONE OF THESE BITS IN MOUEDGE MEANS "BUTTON NOT CLICKED".
00001000                            29  ;              A "CLICK" IS A CHANGE FROM 0 TO 1 IN SUBSEQUENT UPDATES.
00001000                            30  ;              BOTH MOUVEL AND MOUEDGE ARE UPDATED BY TRAP #MOUTRAP
00001000                            31  ;
00001000                            32  ;            * MASKS AND BIT POSITIONS ARE DEFINED TO EASE MOUSE ACCESS. FOR
00001000                            33  ;              EXAMPLE, ONE CAN DO THE FOLLOWING TO CHECK IF THE LEFT BUTTON
00001000                            34  ;              IS PRESSED:
00001000                            35  ;
00001000                            36  ;              BTST.L #MOUBITLF,(MOUVAL)
00001000                            37  ;              BNE ...
00001000                            38  ;
00001000                            39  ;              ALTERNATIVELY, ONE CAN ALSO DO THE FOLLOWING DEPENDING ON THE
00001000                            40  ;              CONTEXT:
00001000                            41  ;
00001000                            42  ;              MOVE.B  (MOUVAL),D0
00001000                            43  ;              AND.B   #MOUMSKLF,D0
00001000                            44  ;              BNE ...
00001000                            45  ; =============================================================================
00001000                            46  
00001000                            47  ; --- SCREEN RELATED CONSTANTS ------------------------------------------------
00001000                            48  
00001000  =00000000                 49  SCRTRAP     EQU     0                       ; SCREEN REFRESH TRAP NUMBER
00001000  =00000320                 50  SCRWIDTH    EQU     800                     ; SCREEN WIDTH (PIXELS)
00001000  =00000258                 51  SCRHEIGH    EQU     600                     ; SCREEN HEIGHT (PIXELS)
00001000                            52  
00001000                            53  ; --- MOUSE RELATED CONSTANTS -------------------------------------------------
00001000                            54  
00001000  =00000001                 55  MOUTRAP     EQU     1                       ; MOUSE QUERY TRAP NUMBER
00001000  =00000001                 56  MOUMSKLF    EQU     %00000001               ; LEFT MOUSE BUTTON MASK
00001000  =00000002                 57  MOUMSKRT    EQU     %00000010               ; RIGHT MOUSE BUTTON MASK
00001000  =00000004                 58  MOUMSKMD    EQU     %00000100               ; MIDDLE MOUSE BUTTON MASL
00001000  =00000000                 59  MOUBITLF    EQU     0                       ; LEFT MOUSE BUTTON BIT POSITION
00001000  =00000001                 60  MOUBITRT    EQU     1                       ; RIGHT MOUSE BUTTON BIT POSITION
00001000  =00000002                 61  MOUBITMD    EQU     2                       ; MIDDLE MOUSE BUTTON BIT POSITION
00001000  =00000002                 62  -------------------- end include --------------------
00001000                            63              INCLUDE "SYSTEM.X68"            ; SYSTEM CODE
00001000                            64  ; =============================================================================
00001000                            65  ; TITLE    : SYSTEM MANAGEMENT (SYSTEM CODE)
00001000                            66  ; AUTHOR   : ANTONI BURGUERA
00001000                            67  ; HISTORY  : 05-JULY-2021 - CREATION
00001000                            68  ; COMMENTS : IT IS DIVIDED IN THREE BLOCKS:
00001000                            69  ;            - SYS : GENERIC.
00001000                            70  ;            - SCR : SCREEN MANAGEMENT.
00001000                            71  ;            - MOU : MOUSE MANAGEMENT
00001000                            72  ;            THE FORMAT OF MOUVAL AND MOUEDGE IS DESCRIBED IN SYSCONST.
00001000                            73  ; =============================================================================
00001000                            74  
00001000                            75  ; -----------------------------------------------------------------------------
00001000                            76  SYSINIT
00001000                            77  ; INITIALIZES THE SYSTEM AS FOLLOWS:
00001000                            78  ; * DISABLES INTERRUPTS
00001000                            79  ; * CALLS SCRINIT
00001000                            80  ; * CALLS MOUINIT
00001000                            81  ; * ENABLES SIMULATOR EXCEPTION PROCESSING
00001000                            82  ; * SWITCHES TO USER
00001000                            83  ; INPUT    - NONE
00001000                            84  ; OUTPUT   - NONE
00001000                            85  ; MODIFIES - NONE
00001000                            86  ; NOTE     - NOTE THAT INTERRUPTS REMAIN DISABLED AFTER THIS SUBROUTINE
00001000                            87  ; -----------------------------------------------------------------------------
00001000                            88              
00001000                            89              
00001000  007C 0700                 90              OR.W    #$0700,SR               ; Disables interrupts
00001004  4EB9 0000107E             91              JSR     SCRINIT                 ; Calls to SCRINIT
0000100A  4EB9 00001020             92              JSR     MOUINIT                 ; Calls to MOUINIT
00001010  103C 0020                 93              MOVE.B  #32,D0                  ; Enable exception processing
00001014  123C 0005                 94              MOVE.B  #5,D1                   
00001018  4E4F                      95              TRAP    #15                      
0000101A  46FC 2000                 96              MOVE    #$2000,SR               ; Switches to user 
0000101E                            97              
0000101E  4E75                      98              RTS
00001020                            99  
00001020                           100  ; =============================================================================
00001020                           101  ; MOUSE MANAGEMENT (SYSTEM CODE)
00001020                           102  ; =============================================================================
00001020                           103  
00001020                           104  ; -----------------------------------------------------------------------------
00001020                           105  MOUINIT
00001020                           106  ; INITIALIZES MOUSE AS FOLLOWS:
00001020                           107  ; * STORES CURRENT MOUSE POSITION AND BUTTON STATUS INTO MOUY, MOUX AND MOUVAL
00001020                           108  ; * CLEARS MOUEDGE
00001020                           109  ; * INSTALLS MOUREAD INTO TRAP #MOUTRAP
00001020                           110  ; INPUT    - NONE
00001020                           111  ; OUTPUT   - NONE
00001020                           112  ; MODIFIES - ALL REGISTERS CAN BE MODIFIED
00001020                           113  ; -----------------------------------------------------------------------------
00001020                           114  
00001020  103C 003D                115              MOVE.B  #61, D0
00001024  123C 0000                116              MOVE.B  #0, D1
00001028  4E4F                     117              TRAP    #15
0000102A  C0BC 00000007            118              AND.L   #7, D0
00001030  13C0 000018F4            119              MOVE.B  D0, MOUVAL
00001036  33C1 000018F2            120              MOVE.W  D1, MOUX
0000103C  4841                     121              SWAP    D1
0000103E  33C1 000018F0            122              MOVE.W  D1, MOUY            
00001044  4239 000018F5            123              CLR.B   MOUEDGE                 ; clears MOUEDGE
0000104A  21FC 00001054 0084       124              MOVE.L  #MOUREAD,($80+MOUTRAP*4) ;Installs mouread into moutrap
00001052                           125              
00001052  4E75                     126              RTS
00001054                           127  
00001054                           128  ; -----------------------------------------------------------------------------
00001054                           129  MOUREAD
00001054                           130  ; MOUSE READING TRAP SERVICE ROUTINE. IT DOES THE FOLLOWING:
00001054                           131  ; * STORES CURRENT MOUSE POSITION INTO MOUY AND MOUX.
00001054                           132  ; * STORES CURRENT BUTTON STATUS INTO MOUVAL
00001054                           133  ; * COMPUTES AND STORES MOUEDGE
00001054                           134  ; INPUT    - NONE
00001054                           135  ; OUTPUT   - NONE
00001054                           136  ; MODIFIES - NONE
00001054                           137  ; -----------------------------------------------------------------------------
00001054                           138                         
00001054  303C 003D                139              MOVE.W  #61,D0
00001058  4281                     140              CLR.L   D1
0000105A  4E4F                     141              TRAP    #15
0000105C  23C1 000018F0            142              MOVE.L  D1,(MOUY)               ; STORES CURRENT POS TO MOUX/Y
00001062  C03C 0007                143              AND.B   #7,D0                   ; AND TO GET ONLY THE LAST 3 BITS
00001066  1439 000018F4            144              MOVE.B  (MOUVAL),D2             ; COMPUTE EDGE
0000106C  4602                     145              NOT.B   D2                      ; EDGE=NOT(PREVIOUS) AND CURRENT
0000106E  C400                     146              AND.B   D0,D2
00001070  13C0 000018F4            147              MOVE.B  D0,(MOUVAL)             ; STORES MOUSE STATUS TO MOUVAL 
00001076  13C2 000018F5            148              MOVE.B  D2,(MOUEDGE)            ; STORES MOUEDGE
0000107C                           149                  
0000107C  4E73                     150              RTE
0000107E                           151  
0000107E                           152  ; =============================================================================
0000107E                           153  ; SCREEN MANAGEMENT (SYSTEM CODE)
0000107E                           154  ; =============================================================================
0000107E                           155  
0000107E                           156  ; -----------------------------------------------------------------------------
0000107E                           157  SCRINIT
0000107E                           158  ; INITIALIZES THE SCREEN, SCREEN-RELATED INTERRUPT AND VARS AS FOLLOWS:
0000107E                           159  ; * INSTALLS SCRUPD INTO TRAP #SCRTRAP
0000107E                           160  ; * SETS OUTPUT RESOLUTION TO SCRWIDTH*SCRHEIGH
0000107E                           161  ; * SETS OUTPUT TO WINDOWED MODE
0000107E                           162  ; * ENABLES DOUBLE BUFFER AND CLEARS BOTH SCREEN BUFFERS
0000107E                           163  ; INPUT    - NONE
0000107E                           164  ; OUTPUT   - NONE
0000107E                           165  ; MODIFIES - ALL REGISTERS CAN BE MODIFIED
0000107E                           166  ; -----------------------------------------------------------------------------
0000107E  21FC 000010B6 0080       167              MOVE.L  #SCRUPD,($80+SCRTRAP*4) ; INSTALL TRAP
00001086  223C 03200258            168              MOVE.L  #SCRWIDTH<<16|SCRHEIGH,D1 ; SET RESOLUTION
0000108C  103C 0021                169              MOVE.B  #33,D0
00001090  4E4F                     170              TRAP    #15
00001092  7201                     171              MOVE.L  #1,D1                   ; SET WINDOWED MODE
00001094  4E4F                     172              TRAP    #15
00001096  323C FF00                173              MOVE.W  #$FF00,D1               ; CLEAR VISIBLE BUFFER
0000109A  103C 000B                174              MOVE.B  #11,D0
0000109E  4E4F                     175              TRAP    #15
000010A0  123C 0011                176              MOVE.B  #17,D1                  ; ENABLE DOUBLE BUFFER
000010A4  103C 005C                177              MOVE.B  #92,D0
000010A8  4E4F                     178              TRAP    #15
000010AA  323C FF00                179              MOVE.W  #$FF00,D1               ; CLEAR HIDDEN BUFFER
000010AE  103C 000B                180              MOVE.B  #11,D0
000010B2  4E4F                     181              TRAP    #15
000010B4  4E75                     182              RTS
000010B6                           183  
000010B6                           184  ; -----------------------------------------------------------------------------
000010B6                           185  SCRUPD
000010B6                           186  ; TRAP SERVICE ROUTINE IN CHARGE OF VISUALIZING CURRENT FRAME AND CLEARING
000010B6                           187  ; BUFFER FOR THE NEXT ONE. PERFORMS TWO TASKS:
000010B6                           188  ; * CLEARS ACTIVE (HIDDEN) GRAPHICS BUFFER
000010B6                           189  ; * SWITCHES ACTIVE AND VISIBLE GRAPHICS BUFFER
000010B6                           190  ; INPUT    - NONE
000010B6                           191  ; OUTPUT   - NONE
000010B6                           192  ; MODIFIES - NONE
000010B6                           193  ; -----------------------------------------------------------------------------
000010B6  48A7 C000                194              MOVEM.W D0-D1,-(A7)
000010BA  103C 005E                195              MOVE.B  #94,D0                  ; UPDATE DOUBLE BUFFER
000010BE  4E4F                     196              TRAP    #15
000010C0  323C FF00                197              MOVE.W  #$FF00,D1               ; CLEAR HIDDEN BUFFER
000010C4  103C 000B                198              MOVE.B  #11,D0
000010C8  4E4F                     199              TRAP    #15
000010CA  4C9F 0003                200              MOVEM.W (A7)+,D0-D1
000010CE  4E73                     201              RTE
000010D0                           202  
000010D0                           203  
000010D0                           204  
000010D0                           205  
000010D0                           206  
000010D0                           207  
000010D0                           208  -------------------- end include --------------------
000010D0                           209              INCLUDE "CONST.X68"             ; USER CONSTANTS
000010D0                           210  ; =============================================================================
000010D0                           211  ; TITLE    : USER CONSTANTS
000010D0                           212  ; AUTHOR   : ANTONI BURGUERA
000010D0                           213  ; HISTORY  : 05-JULY-2021 - CREATION
000010D0                           214  ; COMMENTS : * MOST OF THE CONSTANTS HELP IN PRODUCING A CLEAN CODE
000010D0                           215  ;              IN ACCORDANCE TO THE ASSIGNMENT SPECS, THOUGH THEIR USE IS
000010D0                           216  ;              NOT MANDATORY AS LONG AS THE ASSIGNMENT SPECS ARE FOLLOWED.
000010D0                           217  ;
000010D0                           218  ;            * THE UICOLORS ARE THE BASIC USER INTERFACE COLORS. USING THEM
000010D0                           219  ;              WILL LEAD TO A VISUALLY CONSISTENT USER INTERFACE.
000010D0                           220  ;
000010D0                           221  ;            * THE CHARACTER SIZES SPECIFY WIDTH AND HEIGHT IN PIXELS OF THE
000010D0                           222  ;              TEXT CHARACTERS. THIS SIZE DEPENDS ON THE SYSTEM (WINDOWS) FONTS
000010D0                           223  ;              AND CAN CHANGE FROM ONE COMPUTER TO ANOTHER. FEEL FREE TO ADAPT
000010D0                           224  ;              THEM TO YOUR OWN COMPUTER.
000010D0                           225  ;
000010D0                           226  ;            * CHARACTER SIZES ARE SPECIFIED AS AN EXPONENT AND THE SIZE ITSELF
000010D0                           227  ;              THE EXPONENT IS USEFUL TO MULTIPLY/DIVIDE, WHEN NECESSARY,
000010D0                           228  ;              USING SHIFTS. DEPENDING ON YOUR SYSTEM (WINDOWS) FONTS, CHAR
000010D0                           229  ;              SIZES MAY NOT BE POWER OF TWO. IF THIS IS THE CASE, DO YOUR BEST
000010D0                           230  ;              TO AVOID MULU AND DIVU.
000010D0                           231  ;
000010D0                           232  ;            * MOST OF THE GRD CONSTANTS ARE EXPRESSIONS TO EASE TESTING
000010D0                           233  ;              DIFFERENT RESOLUTIONS. IF TESTS WITH OTHER RESOLUTIONS ARE
000010D0                           234  ;              PERFORMED, TAKE INTO ACCOUNT THAT ALL EXPRESSIONS MUST EVALUATE
000010D0                           235  ;              TO INTEGER. IF THEY DON'T, UNEXPECTED RESULTS CAN HAPPEN.
000010D0                           236  ; =============================================================================
000010D0                           237  
000010D0                           238  ; --- UI COLORS ---------------------------------------------------------------
000010D0                           239  
000010D0  =00000000                240  CLRBLACK    EQU     $00000000               ; BLACK
000010D0  =00FFFFFF                241  CLRWHITE    EQU     $00FFFFFF               ; WHITE
000010D0  =00005500                242  CLRDKGRN    EQU     $00005500               ; DARK GREEN
000010D0  =00006600                243  CLRMDGRN    EQU     $00006600               ; MEDIUN GREEN
000010D0  =0000AA00                244  CLRLTGRN    EQU     $0000AA00               ; LIGHT GREEN
000010D0  =00FF0000                245  CLRLTBLU    EQU     $00FF0000               ; LIGHT BLUE
000010D0  =000000FF                246  CLRLTRED    EQU     $000000FF               ; LIGHT RED
000010D0                           247  
000010D0                           248  ; --- CHARACTER SIZES ---------------------------------------------------------
000010D0                           249  
000010D0  =00000004                250  CHRSHHEI    EQU     4                       ; CHARACTER HEIGHT AS EXPONENT OF 2
000010D0  =00000003                251  CHRSHWID    EQU     3                       ; CHARACTER WIDTH AS EXPONENT OF 2
000010D0  =00000010                252  CHRHEIGH    EQU     1<<CHRSHHEI             ; CHARACTER HEIGHT
000010D0  =00000008                253  CHRWIDTH    EQU     1<<CHRSHWID             ; CHARACTER WIDTH
000010D0                           254  
000010D0                           255  ; --- BUTTON ------------------------------------------------------------------
000010D0                           256  
000010D0  =00000004                257  BTNPENWD    EQU     4                       ; BUTTON LINE WIDTH
000010D0  =00005500                258  BTNPENCL    EQU     CLRDKGRN                ; BUTTON LINE COLOR
000010D0  =0000AA00                259  BTNSELCL    EQU     CLRLTGRN                ; BUTTON SELECTED FILL COLOR
000010D0  =00006600                260  BTNPRSCL    EQU     CLRMDGRN                ; BUTTON PRESSED FILL COLOR
000010D0  =00000006                261  BTNSZVDB    EQU     6                       ; SIZE (BYTES) OF VDB
000010D0                           262  
000010D0                           263  ; --- BUTTON LIST -------------------------------------------------------------
000010D0                           264  
000010D0  =0000000A                265  BTLMXVDB    EQU     10                      ; SIZE OF THE BUTTON LIST (ITEMS)
000010D0  =00000028                266  BTLVERSZ    EQU     40                      ; HEIGHT OF BUTTONS
000010D0  =0000000A                267  BTLVEMRG    EQU     10                      ; VERTICAL VISUAL MARGIN (TOP&BOT)
000010D0  =0000000A                268  BTLHOMRG    EQU     10                      ; HORIZONTAL VISUAL MARGIN (L & R)
000010D0                           269  
000010D0                           270  ; --- APPLICATION -------------------------------------------------------------
000010D0                           271  
000010D0  =00000000                272  GOLSPAUS    EQU     0                       ; PAUSED STATE
000010D0  =00000001                273  GOLSEXEC    EQU     1                       ; EXECUTION STATE
000010D0  =000000FA                274  GOLMAXGN    EQU     250                     ; MAXIMUM NUMBER OF GENERATIONS
000010D0                           275  
000010D0                           276  ; --- GRID --------------------------------------------------------------------
000010D0                           277  
000010D0  =00FF0000                278  GRDCOLP1    EQU     CLRLTBLU                ; PLAYER 1 COLOR
000010D0  =000000FF                279  GRDCOLP2    EQU     CLRLTRED                ; PLAYER 2 COLOR
000010D0  =00000006                280  GRDSHWID    EQU     6                       ; SHIFT TO ACHIEVE GRDWIDTH
000010D0  =00000005                281  GRDSHHEI    EQU     5                       ; SHIFT TO ACHIEVE GRDHEIGH
000010D0  =00000040                282  GRDWIDTH    EQU     1<<GRDSHWID             ; NUMBER OF GRID COLUMNS
000010D0  =00000020                283  GRDHEIGH    EQU     1<<GRDSHHEI             ; NUMBER OF ROWS
000010D0  =0000003F                284  GRDMSWID    EQU     GRDWIDTH-1              ; MASK TO GET X FROM GRID OFFSET
000010D0  =0000001F                285  GRDMSHEI    EQU     GRDHEIGH-1              ; MASK TO GET Y FROM GRID OFFSET
000010D0  =00000300                286  GRDPXWID    EQU     768                     ; GRID DISPLAY WIDTH (PIXELS)
000010D0  =00000180                287  GRDPXHEI    EQU     GRDHEIGH*GRDPXWID/GRDWIDTH ; GRID DISPLAY HEIGHT (PIXELS)
000010D0  =0000000C                288  GRDSZCEL    EQU     GRDPXWID/GRDWIDTH       ; GRID CELL SIZE (PIXELS)
000010D0  =0000006E                289  GRDVEMRG    EQU     3*BTLVEMRG+2*BTLVERSZ   ; TOP MARGIN (2 BUTTON ROWS)
000010D0  =00000010                290  GRDXOFF     EQU     (SCRWIDTH-GRDPXWID)/2   ; X OFFSETS TO DISPLAY CENTERED GRID
000010D0  =0000009E                291  GRDYOFF     EQU     (SCRHEIGH-GRDPXHEI+GRDVEMRG-BTLVEMRG)/2 ; Y OFFSET CENT. GRD
000010D0  =00000002                292  GRDSCP1X    EQU     GRDXOFF/CHRWIDTH        ; PLAYER 1 SCORE X (CHAR RESOL.)
000010D0  =00000009                293  GRDSCP1Y    EQU     GRDYOFF/CHRHEIGH        ; PLAYER 1 SCORE Y (CHAR RESOL.)
000010D0  =0000005E                294  GRDSCP2X    EQU     (GRDXOFF+GRDPXWID)/CHRWIDTH-4 ; PLAYER 2 SCORE X (CHAR RES.)
000010D0  =00000009                295  GRDSCP2Y    EQU     GRDYOFF/CHRHEIGH        ; PLAYER 2 SCORE Y (CHAR RESOL.)
000010D0  =00000030                296  GRDSCNGX    EQU     (SCRWIDTH/(CHRWIDTH*2))-2 ; NUM. GENER. X (CHAR RESOL.)
000010D0  =00000009                297  GRDSCNGY    EQU     GRDYOFF/CHRHEIGH        ; NUM. GENER. Y (CHAR RESOL.)
000010D0  =00000009                298  -------------------- end include --------------------
000010D0                           299              INCLUDE "UTIL.X68"              ; UTILITY CODE
000010D0                           300  ; =============================================================================
000010D0                           301  ; TITLE    : UTILITY SUBROUTINES
000010D0                           302  ; AUTHOR   : ANTONI BURGUERA
000010D0                           303  ; HISTORY  : 05-JULY-2021 - CREATION
000010D0                           304  ; COMMENTS : GENERAL PURPOSE SUBROUTINES.
000010D0                           305  ; =============================================================================
000010D0                           306  
000010D0                           307  ; -----------------------------------------------------------------------------
000010D0                           308  UTLINIT
000010D0                           309  ; INITIALIZES UTILITIES.
000010D0                           310  ; INPUT    : NONE
000010D0                           311  ; OUTPUT   : NONE
000010D0                           312  ; MODIFIES : NONE
000010D0                           313  ; -----------------------------------------------------------------------------
000010D0  4239 000018F6            314              CLR.B   (UTLRNDIX)
000010D6  4E75                     315              RTS
000010D8                           316  
000010D8                           317  ; -----------------------------------------------------------------------------
000010D8                           318  UTLSTRLN
000010D8                           319  ; COMPUTES THE LENGTH OF A ZERO-TERMINATED STRING
000010D8                           320  ; INPUT    - A1 POINTER TO THE STRING
000010D8                           321  ; OUTPUT   - D0.W STRING LENGTH
000010D8                           322  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000010D8                           323  ; -----------------------------------------------------------------------------
000010D8  2F09                     324              MOVE.L  A1,-(A7)
000010DA  4240                     325              CLR.W   D0
000010DC  4A19                     326  .LOOP       TST.B   (A1)+
000010DE  6700 0006                327              BEQ     .END
000010E2  5240                     328              ADDQ.W  #1,D0
000010E4  60F6                     329              BRA     .LOOP
000010E6  225F                     330  .END        MOVE.L  (A7)+,A1
000010E8  4E75                     331              RTS
000010EA                           332  
000010EA                           333  ; -----------------------------------------------------------------------------
000010EA                           334  UTLRAND
000010EA                           335  ; PROVIDES A PSEUDO-RANDOM COIN FLIP (RETURNS 1 OR 2)
000010EA                           336  ; INPUT    - NONE
000010EA                           337  ; OUTPUT   - D1.L RANDOM VALUE (ONLY BYTE)
000010EA                           338  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000010EA                           339  ; -----------------------------------------------------------------------------
000010EA  2F08                     340              MOVE.L  A0,-(A7)
000010EC  41F9 00001108            341              LEA     .RANDVEC,A0
000010F2  4281                     342              CLR.L   D1
000010F4  1239 000018F6            343              MOVE.B  (UTLRNDIX),D1
000010FA  1230 1800                344              MOVE.B  (A0,D1.L),D1
000010FE  5239 000018F6            345              ADDQ.B  #1,(UTLRNDIX)
00001104  205F                     346              MOVE.L  (A7)+,A0
00001106  4E75                     347              RTS
00001108                           348  
00001108= 02 02 02 02 01 02 ...    349  .RANDVEC    DC.B    2, 2, 2, 2, 1, 2, 1, 2
00001110= 01 01 01 02 01 01 ...    350              DC.B    1, 1, 1, 2, 1, 1, 1, 2
00001118= 02 01 02 01 01 02 ...    351              DC.B    2, 1, 2, 1, 1, 2, 2, 1
00001120= 02 01 02 01 01 01 ...    352              DC.B    2, 1, 2, 1, 1, 1, 1, 2
00001128= 02 02 01 01 02 02 ...    353              DC.B    2, 2, 1, 1, 2, 2, 1, 1
00001130= 02 01 02 02 02 01 ...    354              DC.B    2, 1, 2, 2, 2, 1, 1, 1
00001138= 02 02 01 01 01 01 ...    355              DC.B    2, 2, 1, 1, 1, 1, 1, 2
00001140= 01 01 01 02 01 02 ...    356              DC.B    1, 1, 1, 2, 1, 2, 1, 2
00001148= 02 02 02 02 01 02 ...    357              DC.B    2, 2, 2, 2, 1, 2, 1, 2
00001150= 01 01 02 02 02 01 ...    358              DC.B    1, 1, 2, 2, 2, 1, 2, 1
00001158= 02 02 02 01 01 02 ...    359              DC.B    2, 2, 2, 1, 1, 2, 1, 1
00001160= 01 02 01 01 01 02 ...    360              DC.B    1, 2, 1, 1, 1, 2, 1, 2
00001168= 01 02 02 01 02 01 ...    361              DC.B    1, 2, 2, 1, 2, 1, 2, 2
00001170= 01 02 01 02 01 01 ...    362              DC.B    1, 2, 1, 2, 1, 1, 2, 1
00001178= 01 02 01 01 01 01 ...    363              DC.B    1, 2, 1, 1, 1, 1, 1, 1
00001180= 02 01 01 02 01 01 ...    364              DC.B    2, 1, 1, 2, 1, 1, 1, 2
00001188= 02 01 01 01 01 02 ...    365              DC.B    2, 1, 1, 1, 1, 2, 1, 1
00001190= 01 01 02 01 01 02 ...    366              DC.B    1, 1, 2, 1, 1, 2, 1, 2
00001198= 02 02 01 01 02 02 ...    367              DC.B    2, 2, 1, 1, 2, 2, 2, 2
000011A0= 01 01 02 01 02 02 ...    368              DC.B    1, 1, 2, 1, 2, 2, 1, 2
000011A8= 01 02 01 02 02 02 ...    369              DC.B    1, 2, 1, 2, 2, 2, 2, 1
000011B0= 01 01 02 02 01 01 ...    370              DC.B    1, 1, 2, 2, 1, 1, 2, 1
000011B8= 02 02 01 02 01 02 ...    371              DC.B    2, 2, 1, 2, 1, 2, 1, 1
000011C0= 02 01 02 01 01 02 ...    372              DC.B    2, 1, 2, 1, 1, 2, 1, 2
000011C8= 01 01 02 02 02 01 ...    373              DC.B    1, 1, 2, 2, 2, 1, 1, 1
000011D0= 01 01 02 02 01 02 ...    374              DC.B    1, 1, 2, 2, 1, 2, 1, 2
000011D8= 01 02 01 01 01 02 ...    375              DC.B    1, 2, 1, 1, 1, 2, 1, 1
000011E0= 02 01 01 02 01 02 ...    376              DC.B    2, 1, 1, 2, 1, 2, 2, 2
000011E8= 02 01 01 01 02 02 ...    377              DC.B    2, 1, 1, 1, 2, 2, 1, 1
000011F0= 02 02 02 01 02 02 ...    378              DC.B    2, 2, 2, 1, 2, 2, 1, 2
000011F8= 01 02 01 01 02 01 ...    379              DC.B    1, 2, 1, 1, 2, 1, 2, 2
00001200= 02 02 02 01 01 01 ...    380              DC.B    2, 2, 2, 1, 1, 1, 1, 2
00001200= 02 02 02 01 01 01 ...    381  -------------------- end include --------------------
00001208                           382              INCLUDE "BUTTON.X68"            ; BUTTON MANAGEMENT
00001208                           383  ; =============================================================================
00001208                           384  ; TITLE    : BUTTON MANAGEMENT
00001208                           385  ; AUTHOR   : ANTONI BURGUERA
00001208                           386  ; HISTORY  : 05-JULY-2021 - CREATION
00001208                           387  ; COMMENTS : * A BUTTON IS DEFINED BY A STATIC DATA BLOCK (SDB), WHICH DOES NOT
00001208                           388  ;              CHANGE OVER TIME, AND A VARIABLE DATA BLOCK (VDB), THAT CAN
00001208                           389  ;              CHANGE OVER TIME. CHANGES IN THE VDB ARE PRODUCED WHEN CALLING
00001208                           390  ;              SUBROUTINE BTNUPD.
00001208                           391  ;
00001208                           392  ;            * THE BUTTON SDB (CAN BE IN ROM) HAS THE FOLLOWING FIELDS. THE
00001208                           393  ;              NUMBER DENOTES THE OFFSET WITH RESPECT TO THE SDB START:
00001208                           394  ;
00001208                           395  ;                +0  - WORD - YTOP COORDINATE (PIXELS)
00001208                           396  ;                +2  - WORD - XLEFT COORDINATE (PIXELS)
00001208                           397  ;                +4  - WORD - HEIGHT (PIXELS)
00001208                           398  ;                +6  - WORD - WIDTH (PIXELS)
00001208                           399  ;                +8  - LONG - CALLBACK POINTER
00001208                           400  ;                +12 - BYTE STRING - ZERO TERMINATED STRING. TEXT TO SHOW.
00001208                           401  ;
00001208                           402  ;            * THE BUTTON VDB (MUST BE IN RAM) IS:
00001208                           403  ;
00001208                           404  ;                +0 - LONG - POINTER TO THE STATIC DATABLOCK
00001208                           405  ;                +4 - BYTE - STATUS WITH FORMAT XXXXXCPI WHERE:
00001208                           406  ;                            - I (BIT 0) - 1=MOUSE INSIDE, 0=MOUSE OUTSIDE
00001208                           407  ;                            - P (BIT 1) - 1=MOUSE PRESSED INSIDE
00001208                           408  ;                                          0=MOUSE NOT PRESSED INSIDE
00001208                           409  ;                            - C (BIT 2) - 1=MOUSE CLICKED INSIDE
00001208                           410  ;                                          0=MOUSE NOT CLICKED INSIDE
00001208                           411  ;                            NOTE THAT IF I=0 THEN P=C=0, IF I=1 AND P=0
00001208                           412  ;                            THEN C=0.
00001208                           413  ; =============================================================================
00001208                           414  
00001208                           415  ; -----------------------------------------------------------------------------
00001208                           416  BTNINIT
00001208                           417  ; INITIALIZES THE BUTTON BY:
00001208                           418  ;  * COPYING THE SDB POINTER INTO THE VDB.
00001208                           419  ;  * CLEARING THE STATUS BYTE.
00001208                           420  ; INPUT    : A0 - POINTER TO THE VARIABLE DATABLOCK
00001208                           421  ;            A1 - POINTER TO THE STATIC DATABLOCK
00001208                           422  ; OUTPUT   : NONE
00001208                           423  ; MODIFIES : NONE
00001208                           424  ; -----------------------------------------------------------------------------
00001208                           425  
00001208  48E7 FFC0                426              MOVEM.L D0-D7/A0-A1,-(A7)       ; Save content registers
0000120C                           427              
0000120C  2089                     428              MOVE.L  A1,(A0)                 ; Copy SDB pointer into VDB
0000120E  4228 0004                429              CLR.B   4(A0)                   ; CLEAR STATUS BYTE(VDB)                
00001212                           430  
00001212  4CDF 03FF                431              MOVEM.L (A7)+,D0-D7/A0-A1       ; Restore content resgiters
00001216                           432              
00001216  4E75                     433              RTS
00001218                           434  
00001218                           435  ; -----------------------------------------------------------------------------
00001218                           436  BTNUPD
00001218                           437  ; UPDATES THE BUTTON VDB AND EXECUTES THE CALLBACK IF REQUIRED
00001218                           438  ; INPUT    : A0 - POINTER TO THE VARIABLE DATABLOCK
00001218                           439  ; OUTPUT   : NONE
00001218                           440  ; MODIFIES : NONE
00001218                           441  ; -----------------------------------------------------------------------------
00001218                           442              
00001218  48E7 FCE0                443              MOVEM.L D0-D5/A0-A2,-(A7)       ; Save content registers
0000121C                           444              
0000121C  117C 0000 0004           445              MOVE.B   #0,4(A0)               ; CLEAR STATUS BYTE
00001222  2250                     446              MOVE.L  (A0),A1                 ; COPY @ SDB OF BUTTON
00001224                           447              
00001224                           448              ; COPY MOUSE POSITION
00001224  3039 000018F0            449              MOVE.W  MOUY,D0                 ; COPY MOUSE Y POSITION
0000122A  3239 000018F2            450              MOVE.W  MOUX,D1                 ; COPY MOUSE X POSITION
00001230                           451              
00001230                           452              ; GET BUTTON POSITION
00001230  3419                     453              MOVE.W  (A1)+,D2                ; TOP Y
00001232  3619                     454              MOVE.W  (A1)+,D3                ; LEFT X
00001234  3819                     455              MOVE.W  (A1)+,D4                ; HEIGHT
00001236  3A19                     456              MOVE.W  (A1)+,D5                ; WIDTH  
00001238                           457              
00001238                           458              ; IF D2<D0 MOUSE NOT INSIDE (IS UPPER THAN THE BUTTON)
00001238  B042                     459              CMP.W   D2,D0
0000123A  6D00 004A                460              BLT     .MOUSEOUT
0000123E                           461              
0000123E                           462              ; IF D3<D1 MOUSE NOT INSIDE (IS ON THE LEFT SIDE)
0000123E  B243                     463              CMP.W   D3,D1
00001240  6D00 0044                464              BLT     .MOUSEOUT
00001244                           465              
00001244                           466              ; IF D4>D0 MOUSE NOT INSIDE (IS LOWER THAN THE BUTTON)
00001244  D842                     467              ADD.W   D2,D4
00001246  B044                     468              CMP.W   D4,D0
00001248  6E00 003C                469              BGT     .MOUSEOUT
0000124C                           470              
0000124C                           471              ; IF D5>D0 MOUSE NOT INSIDE (IS ON THE RIGHT SIDE)
0000124C  DA43                     472              ADD.W   D3,D5
0000124E  B245                     473              CMP.W   D5,D1
00001250  6E00 0034                474              BGT     .MOUSEOUT
00001254                           475  
00001254                           476              ; UPDATE VDB 
00001254  117C 0001 0004           477              MOVE.B  #1,4(A0)                ; I (BIT 0) = 1
0000125A  0839 0000 000018F4       478              BTST    #0,MOUVAL               ; BUTTON NOT PRESSED?
00001262  6700 0026                479              BEQ     .END                    ; BUTTON NOT PRESSED
00001266  117C 0003 0004           480              MOVE.B  #3,4(A0)                ; P (BIT 1) = 1
0000126C  0839 0000 000018F5       481              BTST    #0,MOUEDGE              ; BUTTON NOT CLICKED?
00001274  6700 0014                482              BEQ     .END                    ; BUTTON NOT CLICKED
00001278  117C 0007 0004           483              MOVE.B  #7,4(A0)                ; C (BIT 2) = 1
0000127E                           484              
0000127E                           485              ; EXECUTE CALLBACK
0000127E  2451                     486              MOVE.L  (A1),A2                 ; COPY @ CALLBACK
00001280  4E92                     487              JSR     (A2)                    ; JUMP TO CALLBACK SUBR
00001282  6000 0006                488              BRA     .END                    
00001286                           489              
00001286  4228 0004                490  .MOUSEOUT   CLR.B   4(A0)                   ; I,P,C = 0
0000128A                           491  
0000128A  4CDF 073F                492  .END        MOVEM.L (A7)+,D0-D5/A0-A2       ; Restore content resgiters
0000128E                           493             
0000128E  4E75                     494              RTS
00001290                           495  
00001290                           496  ; -----------------------------------------------------------------------------
00001290                           497  BTNPLOT
00001290                           498  ; PLOTS THE BUTTON. A RECTANGLE IS DRAWN WITH THICKNESS BTNPENWD. THE CONTOUR
00001290                           499  ; COLOR IS BTNPENCL. THE FILL COLOR IS BLACK IF THE MOUSE IS NOT INSIDE,
00001290                           500  ; BTNSELCL IF THE MOUSE IS INSIDE BUT THE MOUSE BUTTON IS NOT PRESSED AND
00001290                           501  ; BTNPRSCL IF THE MOUSE BUTTON IS PRESSED INSIDE.
00001290                           502  ; INPUT    : A0 - POINTER TO THE VARIABLE DATABLOCK
00001290                           503  ; OUTPUT   : NONE
00001290                           504  ; MODIFIES : NONE
00001290                           505  ; -----------------------------------------------------------------------------
00001290                           506  
00001290  48E7 FFE0                507              MOVEM.L D0-D7/A0-A2,-(A7)       ; Save content registers
00001294                           508              
00001294                           509              ; SET PEN COLOR
00001294  103C 0050                510              MOVE.B  #80,D0
00001298  223C 00005500            511              MOVE.L  #BTNPENCL,D1
0000129E  4E4F                     512              TRAP    #15
000012A0                           513              
000012A0                           514              ; SET PEN WIDTH/THICKNESS
000012A0  103C 005D                515              MOVE.B  #93,D0
000012A4  7204                     516              MOVE.L  #BTNPENWD,D1
000012A6  4E4F                     517              TRAP    #15
000012A8                           518              
000012A8  0C28 0000 0004           519              CMP.B   #0,4(A0)                
000012AE  6700 0020                520              BEQ     .MOUSEOUT
000012B2                           521      
000012B2  0C28 0002 0004           522              CMP.B   #2,4(A0) 
000012B8  6700 000C                523              BEQ     .MOUPRESD 
000012BC                           524      
000012BC                           525              ; MOUSE INSIDE   
000012BC  223C 0000AA00            526              MOVE.L  #BTNSELCL,D1
000012C2  6000 000E                527              BRA     .SALIR
000012C6                           528                
000012C6  223C 00006600            529  .MOUPRESD   MOVE.L  #BTNPRSCL,D1            ; MOUSE PRESSED
000012CC  6000 0004                530              BRA     .SALIR
000012D0                           531              
000012D0  7200                     532  .MOUSEOUT   MOVE.L  #CLRBLACK,D1            ; MOUSE OUTSIDE
000012D2                           533              
000012D2  103C 0051                534  .SALIR      MOVE.B  #81,D0                  ; DRAW BUTTON
000012D6  4E4F                     535              TRAP    #15
000012D8                           536              
000012D8  2250                     537              MOVE.L  (A0),A1                 ; COPY @ SDB OF BUTTON
000012DA  4281                     538              CLR.L   D1
000012DC                           539              
000012DC                           540              ; GET COORDINATES(UP)
000012DC  3419                     541              MOVE.W  (A1)+,D2                ; UPPER Y
000012DE  3219                     542              MOVE.W  (A1)+,D1                ; LEFT X
000012E0                           543              
000012E0                           544              ; GET HEIGHT
000012E0  3819                     545              MOVE.W  (A1)+,D4
000012E2  3F04                     546              MOVE.W  D4,-(A7)
000012E4                           547              
000012E4                           548              ; GET WIDTH 
000012E4  3619                     549              MOVE.W  (A1)+,D3
000012E6  3E03                     550              MOVE.W  D3,D7
000012E8                           551  
000012E8                           552              ; GET COORDINATES(LOW)
000012E8  D641                     553              ADD.W   D1,D3                   ; RIGHT X
000012EA  3A02                     554              MOVE.W  D2,D5                   
000012EC  DA44                     555              ADD.W   D4,D5                   ; LOWER Y
000012EE  3805                     556              MOVE.W  D5,D4 
000012F0                           557              
000012F0                           558              ; DRAW BUTTON
000012F0  103C 0057                559              MOVE.B  #87,D0
000012F4  4E4F                     560              TRAP    #15
000012F6                           561              
000012F6                           562              ; SET PEN COLOR
000012F6  3A01                     563              MOVE.W  D1,D5                   ; SAVE D1 CONTENT
000012F8  103C 0050                564              MOVE.B  #80,D0
000012FC  223C 00FFFFFF            565              MOVE.L  #CLRWHITE,D1
00001302  4E4F                     566              TRAP    #15
00001304  4281                     567              CLR.L   D1
00001306  3205                     568              MOVE.W  D5,D1                   ; RESTORE D1
00001308                           569              
00001308                           570              ; GET & DRAW TEXT
00001308  5849                     571              ADD.W   #4,A1
0000130A                           572              ; TEXTWIDTH  = NUMCAR*CHRWIDTH ; CHARACTER WIDTH
0000130A                           573              ; TEXTHEIGHT = CHRHEIGH        ; CHARACTER HEIGHT
0000130A  4285                     574              CLR.L   D5
0000130C  2450                     575              MOVE.L  (A0),A2
0000130E  D4FC 000C                576              ADD.W   #12,A2
00001312  1C1A                     577              MOVE.B  (A2)+,D6
00001314  BC7C 0000                578  .LOOP       CMP     #0,D6                   ; GET TEXT LENGTH            
00001318  6700 0008                579              BEQ     .DONE
0000131C  5245                     580              ADD.W   #1,D5
0000131E  1C1A                     581              MOVE.B  (A2)+,D6                
00001320  60F2                     582              BRA     .LOOP
00001322  CAFC 0008                583  .DONE       MULU.W  #CHRWIDTH,D5
00001326  9E45                     584              SUB.W   D5,D7                   ; WIDTH-TEXTWIDTH
00001328  8EFC 0002                585              DIVU.W  #2,D7                   ; (WIDTH-TEXTWIDTH)/2
0000132C  D247                     586              ADD.W   D7,D1                   ; LEFTX +(WIDTH-TEXTWIDTH)/2
0000132E                           587  
0000132E  381F                     588              MOVE.W  (A7)+,D4
00001330  0444 0010                589              SUB.W   #CHRHEIGH,D4            ; HEIGHT-TEXTHEIGHT
00001334  88FC 0002                590              DIVU.W  #2,D4                   ; (HEIGHT-TEXTHEIGHT)/2
00001338  D444                     591              ADD.W   D4,D2                   ; UPPERY+(HEIGHT-TEXTHEIGHT)/2
0000133A                           592              
0000133A  103C 005F                593              MOVE.B  #95,D0
0000133E  4E4F                     594              TRAP    #15
00001340                           595              
00001340  4CDF 07FF                596              MOVEM.L (A7)+,D0-D7/A0-A2       ; Restore content resgiters
00001344                           597              
00001344  4E75                     598              RTS
00001346                           599                  
00001346                           600  -------------------- end include --------------------
00001346                           601              INCLUDE "BTNLIST.X68"           ; BUTTON LIST MANAGEMENT
00001346                           602  ; =============================================================================
00001346                           603  ; TITLE    : BUTTON LIST MANAGEMENT
00001346                           604  ; AUTHOR   : ANTONI BURGUERA
00001346                           605  ; HISTORY  : 05-JULY-2021 - CREATION
00001346                           606  ; COMMENTS : * ALLOWS ADDING, UPDATING AND PLOTTING A LIST OF BUTTONS. ALLOWS
00001346                           607  ;              REMOVING THEM ALL, BUT NOT INDIVIDUALLY.
00001346                           608  ;
00001346                           609  ;            * THE LIST OF BUTTONS IS STORED AS A LIST OF BUTTON'S VDB. THIS
00001346                           610  ;              LIST IS STORED AT BTLDATA.
00001346                           611  ;
00001346                           612  ;            * THE LIST OF VBD IS BUILT ASSUMING A MAXIMUM OF BTLMXVDB BUTTONS
00001346                           613  ;              AND A SIZE OF BTNSZVDB BYTES FOR EACH VDB.
00001346                           614  ; =============================================================================
00001346                           615  
00001346                           616  ; -----------------------------------------------------------------------------
00001346                           617  BTLINIT
00001346                           618  ; INITIALIZES BUTTON LIST BY SETTING ALL THE POINTERS TO STATIC DATA BLOCKS
00001346                           619  ; TO $FFFFFFFF.
00001346                           620  ; INPUT    : NONE
00001346                           621  ; OUTPUT   : NONE
00001346                           622  ; MODIFIES : NONE
00001346                           623  ; -----------------------------------------------------------------------------
00001346  48E7 8080                624              MOVEM.L D0/A0,-(A7)
0000134A  41F9 000018F8            625              LEA     BTLDATA,A0
00001350  303C 0009                626              MOVE.W  #BTLMXVDB-1,D0          ; NUM ITERATIONS
00001354  20BC FFFFFFFF            627  .LOOP       MOVE.L  #$FFFFFFFF,(A0)         ; MARK SLOT AS EMPTY
0000135A  5C88                     628              ADD.L   #BTNSZVDB,A0            ; GO TO NEXT SLOT
0000135C  51C8 FFF6                629              DBRA.W  D0,.LOOP                ; LOOP FOR ALL SLOTS
00001360  4CDF 0101                630              MOVEM.L (A7)+,D0/A0
00001364  4E75                     631              RTS
00001366                           632  
00001366                           633  ; -----------------------------------------------------------------------------
00001366  =00001346                634  BTLCLEAR    EQU     BTLINIT
00001366                           635  ; CLEARS THE BUTTON LIST. SAME AS BTLINIT.
00001366                           636  ; INPUT    : NONE
00001366                           637  ; OUTPUT   : NONE
00001366                           638  ; MODIFIES : NONE
00001366                           639  ; -----------------------------------------------------------------------------
00001366                           640  
00001366                           641  ; -----------------------------------------------------------------------------
00001366                           642  BTLADD
00001366                           643  ; ADDS A NEW BUTTON INTO THE BUTTON LIST AND INITS IT.
00001366                           644  ; INPUT    : A1 - POINTER TO THE BUTTON SDB
00001366                           645  ; OUTPUT   : NONE
00001366                           646  ; MODIFIES : NONE
00001366                           647  ; -----------------------------------------------------------------------------
00001366  48E7 8080                648              MOVEM.L A0/D0,-(A7)
0000136A                           649  
0000136A                           650              ; SEARCH FOR AN EMPTY SLOT
0000136A                           651  
0000136A  41F9 000018F8            652              LEA     BTLDATA,A0
00001370  303C 0009                653              MOVE.W  #BTLMXVDB-1,D0
00001374  0C90 FFFFFFFF            654  .LOOP       CMP.L   #$FFFFFFFF,(A0)
0000137A  6700 000E                655              BEQ     .FOUND
0000137E  5C88                     656              ADD.L   #BTNSZVDB,A0
00001380  51C8 FFF2                657              DBRA.W  D0,.LOOP
00001384                           658  
00001384                           659              ; NO SLOT? DO NOTHING
00001384                           660  
00001384  4CDF 0101                661  .END        MOVEM.L (A7)+,A0/D0
00001388  4E75                     662              RTS
0000138A                           663  
0000138A                           664              ; SLOT FOUND? PLACE THE BUTTON THERE BY CALLING BTNINIT
0000138A                           665  
0000138A  4EB8 1208                666  .FOUND      JSR     BTNINIT
0000138E  60F4                     667              BRA     .END
00001390                           668  
00001390                           669  ; -----------------------------------------------------------------------------
00001390                           670  BTLUPD
00001390                           671  ; CALLS BTNUPD FOR ALL THE BUTTONS IN THE BUTTON LIST.
00001390                           672  ; INPUT    : NONE
00001390                           673  ; OUTPUT   : NONE
00001390                           674  ; MODIFIES : NONE
00001390                           675  ; -----------------------------------------------------------------------------
00001390                           676  
00001390  48E7 8080                677              MOVEM.L A0/D0,-(A7)
00001394                           678  
00001394                           679              ; TRAVERSE THE LIST
00001394                           680  
00001394  41F9 000018F8            681              LEA     BTLDATA,A0
0000139A  303C 0009                682              MOVE.W  #BTLMXVDB-1,D0
0000139E  0C90 FFFFFFFF            683  .LOOP       CMP.L   #$FFFFFFFF,(A0)
000013A4  6700 000C                684              BEQ     .DONE
000013A8                           685  
000013A8                           686              ; UPDATE EACH BUTTON
000013A8                           687  
000013A8  4EB8 1218                688              JSR     BTNUPD
000013AC                           689  
000013AC                           690              ; GO TO THE NEXT BUTTON
000013AC                           691  
000013AC  5C88                     692              ADD.L   #BTNSZVDB,A0
000013AE  51C8 FFEE                693              DBRA.W  D0,.LOOP
000013B2                           694  
000013B2  4CDF 0101                695  .DONE       MOVEM.L (A7)+,A0/D0
000013B6  4E75                     696              RTS
000013B8                           697  
000013B8                           698  
000013B8                           699  ; -----------------------------------------------------------------------------
000013B8                           700  BTLPLOT
000013B8                           701  ; CALLS BTNPLOT FOR ALL THE BUTTONS IN THE BUTTON LIST.
000013B8                           702  ; INPUT    : NONE
000013B8                           703  ; OUTPUT   : NONE
000013B8                           704  ; MODIFIES : NONE
000013B8                           705  ; -----------------------------------------------------------------------------
000013B8                           706  
000013B8                           707  ; TODO : PLACE YOUR CODE HERE
000013B8                           708              ; JSR BTLUPD
000013B8                           709              ; RTS
000013B8  48E7 8080                710              MOVEM.L A0/D0,-(A7)             ; Save content registers
000013BC                           711              
000013BC  41F9 000018F8            712              LEA     BTLDATA,A0              ; @ OF THE BUTTONS
000013C2  303C 0009                713              MOVE.W  #BTLMXVDB-1,D0
000013C6  0C90 FFFFFFFF            714  .LOOP       CMP.L   #$FFFFFFFF,(A0)         ; Until end of list
000013CC  6700 000C                715              BEQ     .DONE
000013D0                           716  
000013D0  4EB8 1290                717              JSR     BTNPLOT                 ; Calls BTNUPD
000013D4                           718  
000013D4  5C88                     719              ADD.L   #BTNSZVDB,A0            ; Next button
000013D6  51C8 FFEE                720              DBRA.W  D0,.LOOP
000013DA                           721              
000013DA  4CDF 0101                722  .DONE       MOVEM.L (A7)+,A0/D0             ; Restore content resgiters
000013DE                           723              
000013DE  4E75                     724              RTS
000013E0                           725  
000013E0                           726              
000013E0                           727  
000013E0                           728  
000013E0                           729  
000013E0                           730  
000013E0                           731  
000013E0                           732  
000013E0                           733  
000013E0                           734  
000013E0                           735  
000013E0                           736  -------------------- end include --------------------
000013E0                           737              INCLUDE "GRID.X68"              ; GRID MANAGEMENT
000013E0                           738  ; =============================================================================
000013E0                           739  ; TITLE    : GRID MANAGEMENT
000013E0                           740  ; AUTHOR   : ANTONI BURGUERA
000013E0                           741  ; HISTORY  : 05-JULY-2021 - CREATION
000013E0                           742  ; COMMENTS : * THERE ARE TWO MATRICES (GRDMATR0 AND GRDMATR1) AND TWO POINTERS
000013E0                           743  ;              TO THESE MATRICES (GRDSRC AND GRDDST).
000013E0                           744  ;
000013E0                           745  ;            * THE MATRIX TO BE PLOTTED IS ALWAYS THE ONE POINTED BY GRDDST.
000013E0                           746  ;
000013E0                           747  ;            * THE MATRIX TO BE UPDATED BY THE MOUSE (GRDMUPD) IS ALWAYS THE
000013E0                           748  ;              ONE POINTED BY GRDDST.
000013E0                           749  ;
000013E0                           750  ;            * THE RULES-UPDATE (GRDRUPD) SWITCHES THE POINTERS AND THEN READS
000013E0                           751  ;              THE NEW SOURCE MATRIX (GRDSRC) TO DETERMINE THE NUMBER OF
000013E0                           752  ;              NEIGHBORS. THE RESULTING CELL VALUE IS WRITTEN TO THE DESTINA-
000013E0                           753  ;              TION MATRIX, POINTED BY GRDDST.
000013E0                           754  ; =============================================================================
000013E0                           755  
000013E0                           756  ; -----------------------------------------------------------------------------
000013E0                           757  GRDINIT
000013E0                           758  ; INITIALIZE THE GRID AS FOLLOWS:
000013E0                           759  ; * POINTS THE SOURCE GRID POINTER TO GRDMATR0.
000013E0                           760  ; * POINTS THE DESTINATION GRID POINTER TO GRDMATR1.
000013E0                           761  ; * RESETS THE COUNTERS (GRDNPLR1, GRDNPLR2, GRDNGEN).
000013E0                           762  ; * FILLS THE TWO MATRICES (GRDMATR0 AND GRDMATR1) WITH ZEROS.
000013E0                           763  ; INPUT    : NONE
000013E0                           764  ; OUTPUT   : NONE
000013E0                           765  ; MODIFIES : NONE
000013E0                           766  ; -----------------------------------------------------------------------------
000013E0  48E7 8080                767              MOVEM.L A0/D0,-(A7)
000013E4  23FC 0000193C 00001934   768              MOVE.L  #GRDMATR0,(GRDSRC)
000013EE  23FC 0000213C 00001938   769              MOVE.L  #GRDMATR1,(GRDDST)
000013F8  4279 0000293C            770              CLR.W   (GRDNPLR1)
000013FE  4279 0000293E            771              CLR.W   (GRDNPLR2)
00001404  4279 00002940            772              CLR.W   (GRDNGEN)
0000140A  41F9 0000193C            773              LEA     GRDMATR0,A0
00001410  303C 0FFF                774              MOVE.W  #GRDWIDTH*GRDHEIGH*2-1,D0
00001414  4218                     775  .LOOP       CLR.B   (A0)+
00001416  51C8 FFFC                776              DBRA.W  D0,.LOOP
0000141A  4CDF 0101                777              MOVEM.L (A7)+,A0/D0
0000141E  4E75                     778              RTS
00001420                           779  
00001420                           780  ; -----------------------------------------------------------------------------
00001420                           781  GRDMUPD
00001420                           782  ; GRID UPDATE USING MOUSE. THE INTERFACE IS AS FOLLOWS:
00001420                           783  ; * IF MOUSE IS NOT PRESSED OR IS OUTSIDE THE PLOTTED GRID, DOES NOTHING.
00001420                           784  ; * IF LEFT MOUSE BUTTON IS PRESSED INSIDE THE GRID:
00001420                           785  ;   - A PLAYER 1 (VALUE=1) CELL IS CREATED AT THE MOUSE POSITION IF THE MOUSE
00001420                           786  ;     IS ON THE LEFT HALF OF THE GRID.
00001420                           787  ;   - A PLAYER 2 (VALUE=2) CELL IS CREATED AT THE MOUSE POSITION IF THE MOUSE
00001420                           788  ;     IS ON THE RIGHT HALF OF THE GRID.
00001420                           789  ; * IF RIGHT MOUSE BUTTON IS PRESSED INSIDE THE GRID, THE CELL WHERE THE MOUSE
00001420                           790  ;   IS IS CLEARED (VALUE=0).
00001420                           791  ; INPUT    : NONE
00001420                           792  ; OUTPUT   : NONE
00001420                           793  ; MODIFIES : NONE
00001420                           794  ; -----------------------------------------------------------------------------
00001420                           795  
00001420                           796  ; TODO : PLACE YOUR CODE HERE
00001420                           797  
00001420                           798  
00001420  48E7 FFFE                799              MOVEM.L D0-D7/A0-A6,-(A7)
00001424                           800  
00001424                           801  
00001424  4CDF 7FFF                802              MOVEM.L (A7)+,D0-D7/A0-A6       
00001428  4E75                     803              RTS
0000142A                           804  
0000142A                           805  ; -----------------------------------------------------------------------------
0000142A                           806  GRDRUPD
0000142A                           807  ; UPDATES THE GRID ACCORDING TO 2-PLAYER GAME OF LIFE RULES AS FOLLOWS:
0000142A                           808  ; * ADDS 1 TO THE NUMBER OF GENERATIONS (GRDNGEN)
0000142A                           809  ; * SWITCHES THE MATRIX POINTERS (GRDDST AND GRDSRC).
0000142A                           810  ; * CHECKS THE NEIGHBORS USING THE NEW SOURCE MATRIX (POINTER BY GRDDRC)
0000142A                           811  ; * THE RESULTS OF APPLYING THE RULES ARE WRITTEN INTO THE NEW DESTINATION
0000142A                           812  ;   MATRIX (POINTED BY GRDDST).
0000142A                           813  ; * THE RULES ARE THE FOLLOWING, WHERE P1 AND P2 ARE 1 AND 2 RESPECTIVELY,
0000142A                           814  ;   DEAD CELLS ARE REPRESENTED BY 0 AND NP1 AND NP2 DENOTE THE NUMBER OF
0000142A                           815  ;   PLAYER 1 AND PLAYER 2 NEIGHBORS RESPECTIVELY:
0000142A                           816  ;   + SURVIVAL RULES
0000142A                           817  ;     - IF CELL IS P1 AND NP1-NP2 IS 2 OR 3 -> NEW VALUE IS P1
0000142A                           818  ;     - IF CELL IS P1 AND NP1-NP2 IS 1 AND NP1>=2 -> NEW VALUE IS P1
0000142A                           819  ;     - OTHERWISE -> NEW VALUE IS 0
0000142A                           820  ;     - IF CELL IS P2 AND NP2-NP1 IS 2 OR 3 -> NEW VALUE IS P2
0000142A                           821  ;     - IF CELL IS P2 AND NP2-NP1 IS 1 AND NP2>=2 -> NEW VALUE IS P2
0000142A                           822  ;     - OTHERWISE -> NEW VALUE IS 0
0000142A                           823  ;   + BIRTH RULES
0000142A                           824  ;     - THE CELL HAS EXACTLY THREE P1 NEIGHBOURS AND THE NUMBER
0000142A                           825  ;       OF P2 NEIGHBOURS IS DIFFERENT FROM THREE. IN THIS CASE A
0000142A                           826  ;       P1 TOKEN IS BORN IN THE CELL.
0000142A                           827  ;     - THE CELL HAS EXACTLY THREE P2 NEIGHBOURS AND THE NUMBER
0000142A                           828  ;       OF P1 NEIGHBOURS IS DIFFERENT FROM THREE. IN THIS CASE A
0000142A                           829  ;       P2 TOKEN IS BORN IN THE CELL.
0000142A                           830  ;     - THE CELL HAS EXACTLY THREE WHITE AND THREE BLACK NEIGHBOURS.
0000142A                           831  ;       IN THIS CASE AN UNBIASED COIN DETERMINES WHETHER A WHITE OR
0000142A                           832  ;       BLACK TOKEN IS BORN IN THE CELL.
0000142A                           833  ; INPUT    : NONE
0000142A                           834  ; OUTPUT   : NONE
0000142A                           835  ; MODIFIES : NONE
0000142A                           836  ; -----------------------------------------------------------------------------
0000142A                           837  
0000142A                           838  ; TODO : PLACE YOUR CODE HERE
0000142A                           839  
0000142A  48E7 FFFE                840              MOVEM.L D0-D7/A0-A6,-(A7)
0000142E                           841  
0000142E                           842  
0000142E                           843          
0000142E                           844  
0000142E  4CDF 7FFF                845              MOVEM.L (A7)+,D0-D7/A0-A6       
00001432  4E75                     846              RTS
00001434                           847  
00001434                           848  ; -----------------------------------------------------------------------------
00001434                           849  GRDSAVE
00001434                           850  ; SAVES THE GRID INTO A FILE IN CSV FORMAT
00001434                           851  ; INPUT    : NONE
00001434                           852  ; OUTPUT   : NONE
00001434                           853  ; MODIFIES : NONE
00001434                           854  ; NOTE     : THE LOCAL BUFFER SIZE MUST BE MAX(512,2*GRDWIDTH+1). PLEASE CHANGE
00001434                           855  ;            IT ACCORDINGLY IF GRDWIDTH*2+1 IS LARGER THAN 512.
00001434                           856  ; -----------------------------------------------------------------------------
00001434  48E7 FFFE                857              MOVEM.L D0-D7/A0-A6,-(A7)       ; TO BE OPTIMIZED
00001438  103C 0032                858              MOVE.B  #50,D0                  ; CLOSE ALL FILES (RECOMMENDED)
0000143C  4E4F                     859              TRAP    #15
0000143E  9FFC 00000200            860              SUB.L   #512,A7                 ; ROW BUFFER IN LOCAL MEMORY
00001444  103C 003A                861              MOVE.B  #58,D0                  ; SHOW FILE DIALOG TASK
00001448  7201                     862              MOVE.L  #1,D1                   ; DISPLAY SAVE DIALOG
0000144A  43F9 000014C0            863              LEA     .MSG,A1                 ; STANDARD MESSAGE
00001450  45F9 000014DA            864              LEA     .FILTER,A2              ; NO FILTER
00001456  264F                     865              MOVE.L  A7,A3                   ; FILE NAME BUFFER
00001458  4253                     866              CLR.W   (A3)                    ; ENSURE THERE IS NO STRING
0000145A  4E4F                     867              TRAP    #15
0000145C  4A01                     868              TST.B   D1
0000145E  6700 0054                869              BEQ     .END                    ; IF CANCELLED, DO NOTHING
00001462  224B                     870              MOVE.L  A3,A1                   ; PLACE THE FILENAME INTO A1
00001464  103C 0034                871              MOVE.B  #52,D0                  ; CREATE NEW FILE
00001468  4E4F                     872              TRAP    #15
0000146A  4A40                     873              TST.W   D0                      ; CHECK CREATION ERROR
0000146C  6600 0046                874              BNE     .END                    ; DO NOTHING MORE IF ERROR
00001470  2C4F                     875              MOVE.L  A7,A6                   ; PUT A6 INTO START OF BUFFER
00001472  224F                     876              MOVE.L  A7,A1                   ; PUT A1 INTO START OF BUFFER
00001474  2079 00001938            877              MOVE.L  (GRDDST), A0            ; A0: POINTER TO THE DATA TO WRITE
0000147A  363C 001F                878              MOVE.W  #GRDHEIGH-1,D3          ; D3: NUMBER OF ROWS - 1
0000147E  343C 003F                879  .LOOPY      MOVE.W  #GRDWIDTH-1,D2          ; D2: NUMBER OF COLUMNS - 1
00001482  103C 0030                880  .LOOP       MOVE.B  #'0',D0                 ; ADD CHAR '0' AND THE CELL VALUE
00001486  D018                     881              ADD.B   (A0)+,D0
00001488  1CC0                     882              MOVE.B  D0, (A6)+               ; STORE IT IN THE BUFFER
0000148A  1CFC 002C                883              MOVE.B  #',',(A6)+              ; NOW PUT THE COMMA
0000148E  51CA FFF2                884              DBRA.W  D2,.LOOP
00001492  1D7C 000D FFFF           885              MOVE.B  #$0D,-1(A6)             ; STORE CARRIAGE RETURN (REMOVE ',')
00001498  1CBC 000A                886              MOVE.B  #$0A,(A6)               ; STORE LINE FEED
0000149C  103C 0036                887              MOVE.B  #54,D0                  ; WRITE TO FILE TASK NUMBER
000014A0  243C 00000081            888              MOVE.L  #GRDWIDTH*2+1,D2        ; NUMBER OF BYTES TO WRITE
000014A6  4E4F                     889              TRAP    #15                     ; WRITE (A1 IS ALREADY THERE)
000014A8  2C49                     890              MOVE.L  A1,A6                   ; GO BACK TO THE BUFFER START
000014AA  51CB FFD2                891              DBRA.W  D3,.LOOPY
000014AE  103C 0038                892              MOVE.B  #56,D0                  ; CLOSE FILE
000014B2  4E4F                     893              TRAP    #15
000014B4  DFFC 00000200            894  .END        ADD.L   #512,A7                 ; RESTORE STACK
000014BA  4CDF 7FFF                895              MOVEM.L (A7)+,D0-D7/A0-A6       ; TO BE OPTIMIZED
000014BE  4E75                     896              RTS
000014C0= 53 45 4C 45 43 54 ...    897  .MSG        DC.B    'SELECT A CSV FILE TO SAVE',0
000014DA= 2A 2E 43 53 56 00        898  .FILTER     DC.B    '*.CSV',0
000014E0                           899              DS.W    0
000014E0                           900  
000014E0                           901  ; -----------------------------------------------------------------------------
000014E0                           902  GRDLOAD
000014E0                           903  ; LOADS THE GRID FROM A CSV FORMATTED FILE
000014E0                           904  ; INPUT    : NONE
000014E0                           905  ; OUTPUT   : NONE
000014E0                           906  ; MODIFIES : NONE
000014E0                           907  ; NOTE     : THE LOCAL BUFFER SIZE MUST BE MAX(512,2*GRDWIDTH+1). PLEASE CHANGE
000014E0                           908  ;            IT ACCORDINGLY IF GRDWIDTH*2+1 IS LARGER THAN 512.
000014E0                           909  ; -----------------------------------------------------------------------------
000014E0  48E7 FFFE                910              MOVEM.L D0-D7/A0-A6,-(A7)       ; TO BE OPTIMIZED
000014E4  103C 0032                911              MOVE.B  #50,D0                  ; CLOSE ALL FILES (RECOMMENDED)
000014E8  4E4F                     912              TRAP    #15
000014EA  9FFC 00000200            913              SUB.L   #512,A7                 ; ROW BUFFER IN LOCAL MEMORY
000014F0  103C 003A                914              MOVE.B  #58,D0                  ; SHOW FILE DIALOG TASK
000014F4  4281                     915              CLR.L   D1                      ; DISPLAY LOAD DIALOG
000014F6  43F9 00001560            916              LEA     .MSG,A1                 ; STANDARD MESSAGE
000014FC  45F9 0000157A            917              LEA     .FILTER,A2              ; NO FILTER
00001502  264F                     918              MOVE.L  A7,A3                   ; FILE NAME BUFFER
00001504  4253                     919              CLR.W   (A3)                    ; ENSURE THERE IS NO STRING
00001506  4E4F                     920              TRAP    #15
00001508  4A01                     921              TST.B   D1
0000150A  6700 0048                922              BEQ     .END                    ; IF CANCELLED, DO NOTHING
0000150E  224B                     923              MOVE.L  A3,A1                   ; PLACE THE FILENAME INTO A1
00001510  103C 0033                924              MOVE.B  #51,D0                  ; OPEN EXISTING FILE
00001514  4E4F                     925              TRAP    #15
00001516  4A40                     926              TST.W   D0                      ; CHECK ERRORS
00001518  6600 003A                927              BNE     .END                    ; IF ERRORS, DO NOTHING MORE
0000151C  2C4F                     928              MOVE.L  A7,A6                   ; PUT A6 INTO START OF BUFFER
0000151E  224F                     929              MOVE.L  A7,A1                   ; PUT A1 INTO START OF BUFFER
00001520  2079 00001938            930              MOVE.L  (GRDDST), A0            ; POINTER TO STORE PROCESS. DATA
00001526  363C 001F                931              MOVE.W  #GRDHEIGH-1,D3
0000152A  224E                     932  .LOOP       MOVE.L  A6,A1
0000152C  103C 0035                933              MOVE.B  #53,D0                  ; READ DATA TASK NUMBER
00001530  243C 00000081            934              MOVE.L  #GRDWIDTH*2+1,D2        ; NUMBER OF BYTES TO READ
00001536  4E4F                     935              TRAP    #15                     ; READ THE DATA
00001538  343C 003F                936              MOVE.W  #GRDWIDTH-1,D2
0000153C  1019                     937  .COPY       MOVE.B  (A1)+,D0                ; PICK ONE LOADED CHARACTER
0000153E  0400 0030                938              SUB.B   #'0',D0                 ; CONVERT FROM ASCII TO NUMBER
00001542  10C0                     939              MOVE.B  D0,(A0)+                ; STORE DATA
00001544  5289                     940              ADDQ.L  #1,A1                   ; SKIP THE COMMA
00001546  51CA FFF4                941              DBRA.W  D2,.COPY
0000154A  51CB FFDE                942              DBRA.W  D3,.LOOP
0000154E  103C 0038                943              MOVE.B  #56,D0                  ; CLOSE FILE
00001552  4E4F                     944              TRAP    #15
00001554  DFFC 00000200            945  .END        ADD.L   #512,A7                 ; RESTORE STACK
0000155A  4CDF 7FFF                946              MOVEM.L (A7)+,D0-D7/A0-A6       ; TO BE OPTIMIZED
0000155E  4E75                     947              RTS
00001560= 53 45 4C 45 43 54 ...    948  .MSG        DC.B    'SELECT A CSV FILE TO LOAD',0
0000157A= 2A 2E 43 53 56 00        949  .FILTER     DC.B    '*.CSV',0
00001580                           950              DS.W    0
00001580                           951  
00001580                           952  ; -----------------------------------------------------------------------------
00001580                           953  GRDLLEFT
00001580                           954  ; LOADS THE LEFT PART OF THE GRID FROM A CSV FORMATTED FILE
00001580                           955  ; INPUT    : NONE
00001580                           956  ; OUTPUT   : NONE
00001580                           957  ; MODIFIES : NONE
00001580                           958  ; NOTE     : THE LOCAL BUFFER SIZE MUST BE MAX(512,2*GRDWIDTH+1). PLEASE CHANGE
00001580                           959  ;            IT ACCORDINGLY IF GRDWIDTH*2+1 IS LARGER THAN 512.
00001580                           960  ; NOTE     : ALL THE ACTIVE CELLS ARE STORED AS PLAYER 1 INDEPENDLY OF THEIR
00001580                           961  ;            ACTUAL VALUE.
00001580                           962  ; -----------------------------------------------------------------------------
00001580                           963  
00001580                           964  ; TODO : PLACE YOUR CODE HERE
00001580                           965  
00001580  48E7 FFFE                966              MOVEM.L D0-D7/A0-A6,-(A7)       ; SAVE CONTENT REGISTERS
00001584                           967              
00001584  103C 0032                968              MOVE.B  #50,D0                  ; CLOSE ALL FILES (RECOMMENDED)
00001588  4E4F                     969              TRAP    #15
0000158A  9FFC 00000200            970              SUB.L   #512,A7                 ; ROW BUFFER IN LOCAL MEMORY
00001590  103C 003A                971              MOVE.B  #58,D0                  ; SHOW FILE DIALOG TASK
00001594  4281                     972              CLR.L   D1                      ; DISPLAY LOAD DIALOG
00001596  43F9 00001600            973              LEA     .MSG,A1                 ; STANDARD MESSAGE
0000159C  45F9 0000161A            974              LEA     .FILTER,A2              ; NO FILTER
000015A2  264F                     975              MOVE.L  A7,A3                   ; FILE NAME BUFFER
000015A4  4253                     976              CLR.W   (A3)                    ; ENSURE THERE IS NO STRING
000015A6  4E4F                     977              TRAP    #15
000015A8  4A01                     978              TST.B   D1
000015AA  6700 0048                979              BEQ     .END                    ; IF CANCELLED, DO NOTHING
000015AE  224B                     980              MOVE.L  A3,A1                   ; PLACE THE FILENAME INTO A1
000015B0  103C 0033                981              MOVE.B  #51,D0                  ; OPEN EXISTING FILE
000015B4  4E4F                     982              TRAP    #15
000015B6  4A40                     983              TST.W   D0                      ; CHECK ERRORS
000015B8  6600 003A                984              BNE     .END                    ; IF ERRORS, DO NOTHING MORE
000015BC  2C4F                     985              MOVE.L  A7,A6                   ; PUT A6 INTO START OF BUFFER
000015BE  224F                     986              MOVE.L  A7,A1                   ; PUT A1 INTO START OF BUFFER
000015C0  2079 00001938            987              MOVE.L  (GRDDST), A0            ; POINTER TO STORE PROCESS. DATA
000015C6  363C 001F                988              MOVE.W  #GRDHEIGH-1,D3
000015CA  224E                     989  .LOOP       MOVE.L  A6,A1
000015CC  103C 0035                990              MOVE.B  #53,D0                  ; READ DATA TASK NUMBER
000015D0  243C 00000081            991              MOVE.L  #GRDWIDTH*2+1,D2        ; NUMBER OF BYTES TO READ
000015D6  4E4F                     992              TRAP    #15                     ; READ THE DATA
000015D8                           993              ;En teora llega hasta la mitad de las casillas y se renicia
000015D8                           994              ;para la siguiente fila
000015D8  343C 001F                995              MOVE.W  #(GRDWIDTH/2)-1,D2      ; COPY HALF OF GRID
000015DC  1019                     996  .COPY       MOVE.B  (A1)+,D0                ; PICK ONE LOADED CHARACTER
000015DE  0400 0030                997              SUB.B   #'0',D0                 ; CONVERT FROM ASCII TO NUMBER
000015E2  10C0                     998              MOVE.B  D0,(A0)+                ; STORE DATA
000015E4  5289                     999              ADDQ.L  #1,A1                   ; SKIP THE COMMA
000015E6  51CA FFF4               1000              DBRA.W  D2,.COPY
000015EA  51CB FFDE               1001              DBRA.W  D3,.LOOP
000015EE  103C 0038               1002              MOVE.B  #56,D0                  ; CLOSE FILE
000015F2  4E4F                    1003              TRAP    #15
000015F4  DFFC 00000200           1004  .END        ADD.L   #512,A7                 ; RESTORE STACK
000015FA                          1005              
000015FA  4CDF 7FFF               1006              MOVEM.L (A7)+,D0-D7/A0-A6       ; RESTORES CONTENT REGISTERS
000015FE  4E75                    1007              RTS
00001600                          1008  
00001600= 53 45 4C 45 43 54 ...   1009  .MSG        DC.B    'SELECT A CSV FILE TO LOAD',0
0000161A= 2A 2E 43 53 56 00       1010  .FILTER     DC.B    '*.CSV',0
00001620                          1011              DS.W    0
00001620                          1012  
00001620                          1013  ; -----------------------------------------------------------------------------
00001620                          1014  GRDLRGT
00001620                          1015  ; LOADS THE RIGHT PART OF THE GRID FROM A CSV FORMATTED FILE
00001620                          1016  ; INPUT    : NONE
00001620                          1017  ; OUTPUT   : NONE
00001620                          1018  ; MODIFIES : NONE
00001620                          1019  ; NOTE     : THE LOCAL BUFFER SIZE MUST BE MAX(512,2*GRDWIDTH+1). PLEASE CHANGE
00001620                          1020  ;            IT ACCORDINGLY IF GRDWIDTH*2+1 IS LARGER THAN 512.
00001620                          1021  ; NOTE     : ALL THE ACTIVE CELLS ARE STORED AS PLAYER 2 INDEPENDLY OF THEIR
00001620                          1022  ;            ACTUAL VALUE.
00001620                          1023  ; -----------------------------------------------------------------------------
00001620                          1024  
00001620                          1025  ; TODO : PLACE YOUR CODE HERE
00001620                          1026  
00001620  48E7 FFFE               1027              MOVEM.L D0-D7/A0-A6,-(A7)       ; SAVE CONTENT REGISTERS
00001624                          1028  
00001624  103C 0032               1029              MOVE.B  #50,D0                  ; CLOSE ALL FILES (RECOMMENDED)
00001628  4E4F                    1030              TRAP    #15
0000162A  9FFC 00000200           1031              SUB.L   #512,A7                 ; ROW BUFFER IN LOCAL MEMORY
00001630  103C 003A               1032              MOVE.B  #58,D0                  ; SHOW FILE DIALOG TASK
00001634  4281                    1033              CLR.L   D1                      ; DISPLAY LOAD DIALOG
00001636  43F9 000016A6           1034              LEA     .MSG,A1                 ; STANDARD MESSAGE
0000163C  45F9 000016C0           1035              LEA     .FILTER,A2              ; NO FILTER
00001642  264F                    1036              MOVE.L  A7,A3                   ; FILE NAME BUFFER
00001644  4253                    1037              CLR.W   (A3)                    ; ENSURE THERE IS NO STRING
00001646  4E4F                    1038              TRAP    #15
00001648  4A01                    1039              TST.B   D1
0000164A  6700 004E               1040              BEQ     .END                    ; IF CANCELLED, DO NOTHING
0000164E  224B                    1041              MOVE.L  A3,A1                   ; PLACE THE FILENAME INTO A1
00001650  103C 0033               1042              MOVE.B  #51,D0                  ; OPEN EXISTING FILE
00001654  4E4F                    1043              TRAP    #15
00001656  4A40                    1044              TST.W   D0                      ; CHECK ERRORS
00001658  6600 0040               1045              BNE     .END                    ; IF ERRORS, DO NOTHING MORE
0000165C  2C4F                    1046              MOVE.L  A7,A6                   ; PUT A6 INTO START OF BUFFER
0000165E  224F                    1047              MOVE.L  A7,A1                   ; PUT A1 INTO START OF BUFFER
00001660  2079 00001938           1048              MOVE.L  (GRDDST), A0            ; POINTER TO STORE PROCESS. DATA
00001666  363C 001F               1049              MOVE.W  #GRDHEIGH-1,D3
0000166A  224E                    1050  .LOOP       MOVE.L  A6,A1
0000166C  103C 0035               1051              MOVE.B  #53,D0                  ; READ DATA TASK NUMBER
00001670  243C 00000081           1052              MOVE.L  #GRDWIDTH*2+1,D2        ; NUMBER OF BYTES TO READ
00001676  4E4F                    1053              TRAP    #15                     ; READ THE DATA
00001678                          1054              ;En teora llega hasta la mitad de las casillas y se renicia
00001678                          1055              ;para la siguiente fila
00001678  343C 001F               1056              MOVE.W  #(GRDWIDTH/2)-1,D2      ; COPY HALF OF GRID
0000167C                          1057              ;En teora si se empieza a guadar desde la mitad, se tendra que guardar
0000167C                          1058              ;la parte derecha del grid, es decir, por cada fila sse tiene que empezar
0000167C                          1059              ;por la mitad y para ello sumando la mitad del grid a donde se guarda 
0000167C                          1060              ;tendra que funcionar
0000167C  D0C2                    1061              ADD.W   D2,A0
0000167E  D2FC 0040               1062              ADD.W   #GRDWIDTH,A1            ;A1 contiene el doble or las comas
00001682  1019                    1063  .COPY       MOVE.B  (A1)+,D0                ; PICK ONE LOADED CHARACTER
00001684  0400 0030               1064              SUB.B   #'0',D0                 ; CONVERT FROM ASCII TO NUMBER
00001688  10C0                    1065              MOVE.B  D0,(A0)+                ; STORE DATA
0000168A  5289                    1066              ADDQ.L  #1,A1                   ; SKIP THE COMMA
0000168C  51CA FFF4               1067              DBRA.W  D2,.COPY
00001690  51CB FFD8               1068              DBRA.W  D3,.LOOP
00001694  103C 0038               1069              MOVE.B  #56,D0                  ; CLOSE FILE
00001698  4E4F                    1070              TRAP    #15
0000169A  DFFC 00000200           1071  .END        ADD.L   #512,A7                 ; RESTORE STACK
000016A0                          1072              
000016A0                          1073              
000016A0  4CDF 7FFF               1074              MOVEM.L (A7)+,D0-D7/A0-A6       ; RESTORES CONTENT REGISTERS
000016A4  4E75                    1075              RTS
000016A6                          1076  
000016A6= 53 45 4C 45 43 54 ...   1077  .MSG        DC.B    'SELECT A CSV FILE TO LOAD',0
000016C0= 2A 2E 43 53 56 00       1078  .FILTER     DC.B    '*.CSV',0
000016C6                          1079              DS.W    0
000016C6                          1080  
000016C6                          1081  ; -----------------------------------------------------------------------------
000016C6                          1082  GRDPLOT
000016C6                          1083  ; PLOTS THE GRID
000016C6                          1084  ; INPUT    : NONE
000016C6                          1085  ; OUTPUT   : NONE
000016C6                          1086  ; MODIFIES : NONE
000016C6                          1087  ; -----------------------------------------------------------------------------
000016C6                          1088  
000016C6                          1089  ; TODO : PLACE YOUR CODE HERE
000016C6                          1090  
000016C6  48E7 FFFE               1091              MOVEM.L D0-D7/A0-A6,-(A7)       ; SAVE CONTENT REGISTERS
000016CA                          1092              
000016CA                          1093              
000016CA                          1094  
000016CA                          1095              ;RECORRER MATRIZ E IR PINTADO
000016CA                          1096              ;DIBUJAR LINEAS GRID
000016CA                          1097              ; SET PEN COLOR
000016CA  103C 0050               1098              MOVE.B  #80,D0
000016CE  223C 00005500           1099              MOVE.L  #CLRDKGRN,D1
000016D4  4E4F                    1100              TRAP    #15
000016D6                          1101              
000016D6                          1102              ; SET PEN WIDTH/THICKNESS
000016D6  103C 005D               1103              MOVE.B  #93,D0
000016DA  7202                    1104              MOVE.L  #2,D1
000016DC  4E4F                    1105              TRAP    #15
000016DE                          1106              
000016DE                          1107              ;DRAW LINES
000016DE  103C 0054               1108              MOVE.B  #84,D0
000016E2                          1109              
000016E2                          1110              ;VERTICAL                       
000016E2  3A3C 0040               1111              MOVE.W  #GRDWIDTH,D5
000016E6  323C 0010               1112              MOVE.W  #GRDXOFF,D1             ; X1
000016EA  343C 009E               1113              MOVE.W  #GRDYOFF,D2             ; Y1
000016EE  363C 0010               1114              MOVE.W  #GRDXOFF,D3             ; X2
000016F2  383C 0180               1115              MOVE.W  #GRDPXHEI,D4
000016F6  D842                    1116              ADD.W   D2,D4                   ; Y2
000016F8                          1117              
000016F8  4E4F                    1118  .LNVRTCL    TRAP    #15
000016FA  0641 000C               1119              ADD.W   #GRDSZCEL,D1
000016FE  3601                    1120              MOVE.W  D1,D3               
00001700  51CD FFF6               1121              DBRA.W  D5,.LNVRTCL
00001704                          1122              
00001704                          1123              ;HORIZONTAL
00001704  3A3C 0020               1124              MOVE.W  #GRDHEIGH,D5
00001708  323C 0010               1125              MOVE.W  #GRDXOFF,D1             ;X1
0000170C  363C 0300               1126              MOVE.W  #GRDPXWID,D3
00001710  D641                    1127              ADD.W   D1,D3
00001712  383C 009E               1128              MOVE.W  #GRDYOFF,D4             ;Y2
00001716                          1129              
00001716  4E4F                    1130  .LNHRZNTL   TRAP    #15           
00001718  0642 000C               1131              ADD.W   #GRDSZCEL,D2
0000171C  3802                    1132              MOVE.W  D2,D4
0000171E  51CD FFF6               1133              DBRA.W  D5,.LNHRZNTL
00001722                          1134      
00001722                          1135              
00001722  4CDF 7FFF               1136              MOVEM.L (A7)+,D0-D7/A0-A6       ; RESTORE CONTENT REGISTERS
00001726                          1137       
00001726  4E75                    1138              RTS
00001728                          1139  
00001728                          1140  
00001728                          1141  
00001728                          1142  
00001728                          1143  
00001728                          1144  
00001728                          1145  
00001728                          1146  
00001728                          1147  
00001728                          1148  
00001728                          1149  
00001728                          1150  
00001728                          1151  
00001728                          1152  
00001728                          1153  
00001728                          1154  
00001728                          1155  
00001728                          1156  
00001728                          1157  
00001728                          1158  
00001728                          1159  
00001728                          1160  
00001728                          1161  
00001728                          1162  
00001728                          1163  
00001728                          1164  
00001728                          1165  
00001728                          1166  
00001728                          1167  
00001728                          1168  
00001728                          1169  
00001728                          1170  
00001728                          1171  
00001728                          1172  
00001728                          1173  
00001728                          1174  
00001728                          1175  
00001728                          1176  -------------------- end include --------------------
00001728                          1177              INCLUDE "GOL.X68"               ; GAME OF LIFE APPLICATION
00001728                          1178  ; =============================================================================
00001728                          1179  ; TITLE    : GAME OF LIFE APPLICATION
00001728                          1180  ; AUTHOR   : ANTONI BURGUERA
00001728                          1181  ; HISTORY  : 05-JULY-2021 - CREATION
00001728                          1182  ; COMMENTS : THIS IS AN APPLICATION. SO, IT IMPLEMENTS INITIALIZATION, UPDATE
00001728                          1183  ;            AND PLOT, AS WELL AS SOME AUXILIARY SUBROUTINES.
00001728                          1184  ; =============================================================================
00001728                          1185  
00001728                          1186  ; -----------------------------------------------------------------------------
00001728                          1187  GOLINIT
00001728                          1188  ; INITIALIZE GAME OF LIFE APPLICATION AS FOLLOWS:
00001728                          1189  ; * MAKES THE INTERNAL STATE TO BE "PAUSED/STOPPED"
00001728                          1190  ; * INITIALIZES THE USER INTERFACE (BY INITIALIZING THE BUTTONS LIST AND
00001728                          1191  ;   ADDING BUTTONS INTO IT)
00001728                          1192  ; * INITIALIZES THE GRID.
00001728                          1193  ; * INITIALIZES THE UTILITY CODE.
00001728                          1194  ; INPUT    : NONE
00001728                          1195  ; OUTPUT   : NONE
00001728                          1196  ; MODIFIES : NONE
00001728                          1197  ; -----------------------------------------------------------------------------
00001728  48E7 FFFE               1198              MOVEM.L D0-D7/A0-A6,-(A7)
0000172C  13FC 0000 00002942      1199              MOVE.B  #GOLSPAUS,(GOLSTATE)
00001734  4EB8 1346               1200              JSR     BTLINIT
00001738  41F9 0000175E           1201              LEA     .SDBLIST,A0
0000173E  2258                    1202  .LOOP       MOVE.L  (A0)+,A1
00001740  B3FC FFFFFFFF           1203              CMP.L   #-1,A1
00001746  6700 0008               1204              BEQ     .END
0000174A  4EB8 1366               1205              JSR     BTLADD
0000174E  60EE                    1206              BRA     .LOOP
00001750  4EB8 13E0               1207  .END        JSR     GRDINIT
00001754  4EB8 10D0               1208              JSR     UTLINIT
00001758  4CDF 7FFF               1209              MOVEM.L (A7)+,D0-D7/A0-A6
0000175C  4E75                    1210              RTS
0000175E= 0000183A 0000184C ...   1211  .SDBLIST    DC.L    GOLCLRBT,GOLRUNBT,GOLSTPBT,GOLSTEBT,GOLLLFBT,GOLLRTBT
00001776= 000018AE 000018C4 ...   1212              DC.L    GOLLOABT,GOLSAVBT,-1
00001782                          1213  
00001782                          1214  ; -----------------------------------------------------------------------------
00001782                          1215  GOLUPD
00001782                          1216  ; UPDATE GAME OF LIFE APPLICATION AS FOLLOWS:
00001782                          1217  ; * UPDATES THE BUTTON LIST
00001782                          1218  ; * EXECUTES CODE DEPENDING ON THE CURRENT APPLICATION STATE.
00001782                          1219  ; INPUT    : NONE
00001782                          1220  ; OUTPUT   : NONE
00001782                          1221  ; MODIFIES : NONE
00001782                          1222  ; -----------------------------------------------------------------------------
00001782  48E7 C0C0               1223              MOVEM.L A0-A1/D0-D1,-(A7)
00001786  4EB8 1390               1224              JSR     BTLUPD
0000178A  41F9 000017A6           1225              LEA     .JMPTBL,A0
00001790  4280                    1226              CLR.L   D0
00001792  1039 00002942           1227              MOVE.B  (GOLSTATE),D0
00001798  E508                    1228              LSL.B   #2,D0
0000179A  2070 0000               1229              MOVE.L  (A0,D0),A0
0000179E  4E90                    1230              JSR     (A0)
000017A0  4CDF 0303               1231              MOVEM.L (A7)+,A0-A1/D0-D1
000017A4  4E75                    1232              RTS
000017A6= 00001420 000017B6       1233  .JMPTBL     DC.L    GRDMUPD,GOLDORUN
000017AE                          1234  
000017AE                          1235  ; -----------------------------------------------------------------------------
000017AE                          1236  GOLPLOT
000017AE                          1237  ; PLOTS THE APPLICATION BY CALLING BTLPLOT AND GRDPLOT
000017AE                          1238  ; INPUT    : NONE
000017AE                          1239  ; OUTPUT   : NONE
000017AE                          1240  ; MODIFIES : NONE
000017AE                          1241  ; -----------------------------------------------------------------------------
000017AE  4EB8 13B8               1242              JSR     BTLPLOT
000017B2  4EF8 16C6               1243              JMP     GRDPLOT
000017B6                          1244  
000017B6                          1245  ; -----------------------------------------------------------------------------
000017B6                          1246  GOLDORUN
000017B6                          1247  ; EXECUTES THE RUN STATE. IT ALSO CHECKS IF THE MAXIMUM NUMBER OF GENERATIONS
000017B6                          1248  ; IS REACHED AND, IF SO, ANNOUNCES THE WINNER.
000017B6                          1249  ; INPUT    : NONE
000017B6                          1250  ; OUTPUT   : NONE
000017B6                          1251  ; MODIFIES : NONE
000017B6                          1252  ; -----------------------------------------------------------------------------
000017B6  48E7 8040               1253              MOVEM.L D0/A1,-(A7)
000017BA  0C79 00FA 00002940      1254              CMP.W   #GOLMAXGN,(GRDNGEN)
000017C2  6D00 0034               1255              BLT     .DOIT
000017C6  43F9 00001818           1256              LEA     .TIE,A1
000017CC  3039 0000293C           1257              MOVE.W  (GRDNPLR1),D0
000017D2  B079 0000293E           1258              CMP.W   (GRDNPLR2),D0
000017D8  6700 0012               1259              BEQ     .PLAYSOUND
000017DC  43F9 00001802           1260              LEA     .P1WINS,A1
000017E2  6E00 0008               1261              BGT     .PLAYSOUND
000017E6  43F9 0000180D           1262              LEA     .P2WINS,A1
000017EC  103C 0046               1263  .PLAYSOUND  MOVE.B  #70,D0
000017F0  4E4F                    1264              TRAP    #15
000017F2  4EB9 00001830           1265  .NOSOUND    JSR     GOLTOPAU
000017F8  4EB8 142A               1266  .DOIT       JSR     GRDRUPD
000017FC  4CDF 0201               1267              MOVEM.L (A7)+,D0/A1
00001800  4E75                    1268              RTS
00001802= 50 31 57 49 4E 53 ...   1269  .P1WINS     DC.B    'P1WINS.WAV',0
0000180D= 50 32 57 49 4E 53 ...   1270  .P2WINS     DC.B    'P2WINS.WAV',0
00001818= 54 49 45 2E 57 41 ...   1271  .TIE        DC.B    'TIE.WAV',0
00001820                          1272              DS.W    0
00001820                          1273  
00001820                          1274  ; -----------------------------------------------------------------------------
00001820                          1275  GOLTORUN
00001820                          1276  ; SWITCHES TO RUN STATE
00001820                          1277  ; INPUT    : NONE
00001820                          1278  ; OUTPUT   : NONE
00001820                          1279  ; MODIFIES : NONE
00001820                          1280  ; -----------------------------------------------------------------------------
00001820  4279 00002940           1281              CLR.W   (GRDNGEN)               ; CLEAR GENERATIONS COUNT
00001826  13FC 0001 00002942      1282              MOVE.B  #GOLSEXEC,(GOLSTATE)
0000182E  4E75                    1283              RTS
00001830                          1284  
00001830                          1285  ; -----------------------------------------------------------------------------
00001830                          1286  GOLTOPAU
00001830                          1287  ; SWITCHES TO PAUSE STATE
00001830                          1288  ; INPUT    : NONE
00001830                          1289  ; OUTPUT   : NONE
00001830                          1290  ; MODIFIES : NONE
00001830                          1291  ; -----------------------------------------------------------------------------
00001830  13FC 0000 00002942      1292              MOVE.B  #GOLSPAUS,(GOLSTATE)
00001838  4E75                    1293              RTS
0000183A                          1294  
0000183A                          1295  ; --- STATIC DATA -------------------------------------------------------------
0000183A                          1296  
0000183A                          1297  ; CLEAR BUTTON SDB
0000183A                          1298  
0000183A= 000A                    1299  GOLCLRBT    DC.W    BTLVEMRG                ; YTOP
0000183C= 000A                    1300              DC.W    0*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
0000183E= 0028                    1301              DC.W    BTLVERSZ                ; HEIGHT
00001840= 00B4                    1302              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
00001842                          1303  ; TODO: PLACE THE CALLBACK HERE
00001842= 000013E0                1304              DC.L    GRDINIT                 ; CALLBACK(GRID.X68)
00001846= 43 4C 45 41 52 00       1305              DC.B    'CLEAR',0               ; TEXT
0000184C                          1306              DS.W    0
0000184C                          1307  
0000184C                          1308  ; RUN BUTTON SDB
0000184C                          1309  
0000184C= 000A                    1310  GOLRUNBT    DC.W    BTLVEMRG                ; YTOP
0000184E= 00D2                    1311              DC.W    1*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
00001850= 0028                    1312              DC.W    BTLVERSZ                ; HEIGHT
00001852= 00B4                    1313              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
00001854                          1314  ; TODO: PLACE THE CALLBACK HERE
00001854= 00001820                1315              DC.L    GOLTORUN                ; CALLBACK(GOL.X68)
00001858= 52 55 4E 00             1316              DC.B    'RUN',0                 ; TEXT
0000185C                          1317              DS.W    0
0000185C                          1318  
0000185C                          1319  ; STOP BUTTON SDB
0000185C                          1320  
0000185C= 000A                    1321  GOLSTPBT    DC.W    BTLVEMRG                ; YTOP
0000185E= 019A                    1322              DC.W    2*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
00001860= 0028                    1323              DC.W    BTLVERSZ                ; HEIGHT
00001862= 00B4                    1324              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
00001864                          1325  ; TODO: PLACE THE CALLBACK HERE
00001864= 00001830                1326              DC.L    GOLTOPAU                ; CALLBACK(GOL.X68)
00001868= 53 54 4F 50 00          1327              DC.B    'STOP',0                ; TEXT
0000186E                          1328              DS.W    0
0000186E                          1329  
0000186E                          1330  ; STEP BUTTON SDB
0000186E                          1331  
0000186E= 000A                    1332  GOLSTEBT    DC.W    BTLVEMRG                ; YTOP
00001870= 0262                    1333              DC.W    3*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
00001872= 0028                    1334              DC.W    BTLVERSZ                ; HEIGHT
00001874= 00B4                    1335              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
00001876                          1336  ; TODO: PLACE THE CALLBACK HERE
00001876= 0000142A                1337              DC.L    GRDRUPD                 ; CALLBACK(GRID.X68)
0000187A= 53 54 45 50 00          1338              DC.B    'STEP',0                ; TEXT
00001880                          1339              DS.W    0
00001880                          1340  
00001880                          1341  ; LOAD LEFT BUTTON SDB
00001880                          1342  
00001880= 003C                    1343  GOLLLFBT    DC.W    2*BTLVEMRG+BTLVERSZ     ; YTOP
00001882= 000A                    1344              DC.W    0*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
00001884= 0028                    1345              DC.W    BTLVERSZ                ; HEIGHT
00001886= 00B4                    1346              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
00001888                          1347  ; TODO: PLACE THE CALLBACK HERE
00001888= 00001580                1348              DC.L    GRDLLEFT                ; CALLBACK(GRID.X68)
0000188C= 4C 4F 41 44 20 4C ...   1349              DC.B    'LOAD LEFT',0           ; TEXT
00001896                          1350              DS.W    0
00001896                          1351  
00001896                          1352  ; LOAD RIGHT BUTTON SDB
00001896                          1353  
00001896= 003C                    1354  GOLLRTBT    DC.W    2*BTLVEMRG+BTLVERSZ     ; YTOP
00001898= 00D2                    1355              DC.W    1*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
0000189A= 0028                    1356              DC.W    BTLVERSZ                ; HEIGHT
0000189C= 00B4                    1357              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
0000189E                          1358  ; TODO: PLACE THE CALLBACK HERE
0000189E= 00001620                1359              DC.L    GRDLRGT                 ; CALLBACK(GRID.X68)
000018A2= 4C 4F 41 44 20 52 ...   1360              DC.B    'LOAD RIGHT',0          ; TEXT
000018AE                          1361              DS.W    0
000018AE                          1362  
000018AE                          1363  ; LOAD ALL BUTTON SDB
000018AE                          1364  
000018AE= 003C                    1365  GOLLOABT    DC.W    2*BTLVEMRG+BTLVERSZ     ; YTOP
000018B0= 019A                    1366              DC.W    2*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
000018B2= 0028                    1367              DC.W    BTLVERSZ                ; HEIGHT
000018B4= 00B4                    1368              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
000018B6                          1369  ; TODO: PLACE THE CALLBACK HERE
000018B6= 000014E0                1370              DC.L    GRDLOAD                 ; CALLBACK(GRID.X68)
000018BA= 4C 4F 41 44 20 41 ...   1371              DC.B    'LOAD ALL',0            ; TEXT
000018C4                          1372              DS.W    0
000018C4                          1373  
000018C4                          1374  ; SAVE BUTTON SDB
000018C4                          1375  
000018C4= 003C                    1376  GOLSAVBT    DC.W    2*BTLVEMRG+BTLVERSZ     ; YTOP
000018C6= 0262                    1377              DC.W    3*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
000018C8= 0028                    1378              DC.W    BTLVERSZ                ; HEIGHT
000018CA= 00B4                    1379              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
000018CC                          1380  ; TODO: PLACE THE CALLBACK HERE
000018CC= 00001434                1381              DC.L    GRDSAVE                 ; CALLBACK (GRID.X68)
000018D0= 53 41 56 45 00          1382              DC.B    'SAVE',0                ; TEXT
000018D6                          1383              DS.W    0
000018D6                          1384  
000018D6                          1385  -------------------- end include --------------------
000018D6                          1386  
000018D6                          1387  ; --- INITIALIZE --------------------------------------------------------------
000018D6                          1388  
000018D6  4EB8 1000               1389  START       JSR     SYSINIT                 ; INITIALIZE SYSTEM CODE
000018DA  4EB8 1728               1390              JSR     GOLINIT                 ; INITIALIZE GAME OF LIFE
000018DE                          1391  
000018DE                          1392  ; --- UPDATE ------------------------------------------------------------------
000018DE                          1393  
000018DE  4E41                    1394  .LOOP       TRAP    #MOUTRAP                ; READ MOUSE
000018E0  4EB8 1782               1395              JSR     GOLUPD                  ; UPDATE APPLICATION
000018E4                          1396  
000018E4                          1397  ; --- PLOT --------------------------------------------------------------------
000018E4                          1398  
000018E4  4EB8 17AE               1399              JSR     GOLPLOT                 ; PLOT APPLICATION
000018E8  4E40                    1400              TRAP    #SCRTRAP                ; SHOW GRAPHICS
000018EA  60F2                    1401              BRA     .LOOP
000018EC  FFFF FFFF               1402              SIMHALT
000018F0                          1403  
000018F0                          1404  ; --- VARIABLES ---------------------------------------------------------------
000018F0                          1405  
000018F0                          1406              INCLUDE "SYSVAR.X68"            ; SYSTEM VARIABLES
000018F0                          1407  ; =============================================================================
000018F0                          1408  ; TITLE    : SYSTEM VARS
000018F0                          1409  ; AUTHOR   : ANTONI BURGUERA
000018F0                          1410  ; HISTORY  : 05-JULY-2021 - CREATION
000018F0                          1411  ; COMMENTS : * ALL THESE VARS ARE USED TO SHARE DATA FROM SYSTEM TO USER. THUS
000018F0                          1412  ;              THEY MUST NOT BE IN PROTECTED MEMORY.
000018F0                          1413  ;
000018F0                          1414  ;            * SINCE SOME SUBROUTINES TAKE ADVANTAGE OF THE ORDER IN WHICH
000018F0                          1415  ;              THE VARIABLES ARE IN MEMORY, THEIR ORDER SHOULD NOT BE ALTERED.
000018F0                          1416  ; =============================================================================
000018F0                          1417  
000018F0                          1418  ; --- MOUSE RELATED VARIABLES -------------------------------------------------
000018F0                          1419  
000018F0                          1420  MOUY        DS.W    1                       ; MOUSE Y COORDINATE
000018F2                          1421  MOUX        DS.W    1                       ; MOUSE X COORDINATE
000018F4                          1422  MOUVAL      DS.B    1                       ; CURRENT MOUSE BUTTON STATUS
000018F5                          1423  MOUEDGE     DS.B    1                       ; RISING EDGES IN MOUVAL
000018F6                          1424              DS.W    0
000018F6                          1425  -------------------- end include --------------------
000018F6                          1426              INCLUDE "VAR.X68"               ; USER VARIABLES
000018F6                          1427  ; =============================================================================
000018F6                          1428  ; TITLE    : USER VARS
000018F6                          1429  ; AUTHOR   : ANTONI BURGUERA
000018F6                          1430  ; HISTORY  : 05-JULY-2021 - CREATION
000018F6                          1431  ; COMMENTS : SEE THE CORRESPONDING FILES (UTIL.X68, BTNLIST.X68, GRID.X68 OR
000018F6                          1432  ;            GOL.X68) TO LEARN ABOUT THE MEANING OF THESE VARIABLES.
000018F6                          1433  ; =============================================================================
000018F6                          1434  
000018F6                          1435  ; --- UTILITY VARS ------------------------------------------------------------
000018F6                          1436  
000018F6                          1437  UTLRNDIX    DS.B    1                       ; RANDOM GENERATOR INDEX
000018F8                          1438              DS.W    0
000018F8                          1439  
000018F8                          1440  ; --- BUTTON LIST -------------------------------------------------------------
000018F8                          1441  
000018F8                          1442  BTLDATA     DS.B    BTLMXVDB*BTNSZVDB       ; BUTTONS VDB STORAGE
00001934                          1443              DS.W    0
00001934                          1444  
00001934                          1445  ; --- GRID --------------------------------------------------------------------
00001934                          1446  
00001934                          1447  GRDSRC      DS.L    1                       ; SOURCE MATRIX POINTER
00001938                          1448  GRDDST      DS.L    1                       ; DESTINATION MATRIX POINTER
0000193C                          1449  GRDMATR0    DS.B    GRDWIDTH*GRDHEIGH       ; ONE OF THE GRIDS...
0000213C                          1450  GRDMATR1    DS.B    GRDWIDTH*GRDHEIGH       ; THE OTHER GRID
0000293C                          1451  GRDNPLR1    DS.W    1                       ; NUMBER OF PLAYER 1 CELLS
0000293E                          1452  GRDNPLR2    DS.W    1                       ; NUMBER OF PLAYER 2 CELLS
00002940                          1453  GRDNGEN     DS.W    1                       ; NUMOER OF GENERATIONS
00002942                          1454  
00002942                          1455  ; --- APPLICATION -------------------------------------------------------------
00002942                          1456  
00002942                          1457  GOLSTATE    DS.B    1                       ; APPLICATION STATE
00002944                          1458              DS.W    0
00002944                          1459  -------------------- end include --------------------
00002944                          1460  
00002944                          1461              END    START

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
BTLADD              1366
BTLADD:END          1384
BTLADD:FOUND        138A
BTLADD:LOOP         1374
BTLCLEAR            1346
BTLDATA             18F8
BTLHOMRG            A
BTLINIT             1346
BTLINIT:LOOP        1354
BTLMXVDB            A
BTLPLOT             13B8
BTLPLOT:DONE        13DA
BTLPLOT:LOOP        13C6
BTLUPD              1390
BTLUPD:DONE         13B2
BTLUPD:LOOP         139E
BTLVEMRG            A
BTLVERSZ            28
BTNINIT             1208
BTNPENCL            5500
BTNPENWD            4
BTNPLOT             1290
BTNPLOT:DONE        1322
BTNPLOT:LOOP        1314
BTNPLOT:MOUPRESD    12C6
BTNPLOT:MOUSEOUT    12D0
BTNPLOT:SALIR       12D2
BTNPRSCL            6600
BTNSELCL            AA00
BTNSZVDB            6
BTNUPD              1218
BTNUPD:END          128A
BTNUPD:MOUSEOUT     1286
CHRHEIGH            10
CHRSHHEI            4
CHRSHWID            3
CHRWIDTH            8
CLRBLACK            0
CLRDKGRN            5500
CLRLTBLU            FF0000
CLRLTGRN            AA00
CLRLTRED            FF
CLRMDGRN            6600
CLRWHITE            FFFFFF
GOLCLRBT            183A
GOLDORUN            17B6
GOLDORUN:DOIT       17F8
GOLDORUN:NOSOUND    17F2
GOLDORUN:P1WINS     1802
GOLDORUN:P2WINS     180D
GOLDORUN:PLAYSOUND  17EC
GOLDORUN:TIE        1818
GOLINIT             1728
GOLINIT:END         1750
GOLINIT:LOOP        173E
GOLINIT:SDBLIST     175E
GOLLLFBT            1880
GOLLOABT            18AE
GOLLRTBT            1896
GOLMAXGN            FA
GOLPLOT             17AE
GOLRUNBT            184C
GOLSAVBT            18C4
GOLSEXEC            1
GOLSPAUS            0
GOLSTATE            2942
GOLSTEBT            186E
GOLSTPBT            185C
GOLTOPAU            1830
GOLTORUN            1820
GOLUPD              1782
GOLUPD:JMPTBL       17A6
GRDCOLP1            FF0000
GRDCOLP2            FF
GRDDST              1938
GRDHEIGH            20
GRDINIT             13E0
GRDINIT:LOOP        1414
GRDLLEFT            1580
GRDLLEFT:COPY       15DC
GRDLLEFT:END        15F4
GRDLLEFT:FILTER     161A
GRDLLEFT:LOOP       15CA
GRDLLEFT:MSG        1600
GRDLOAD             14E0
GRDLOAD:COPY        153C
GRDLOAD:END         1554
GRDLOAD:FILTER      157A
GRDLOAD:LOOP        152A
GRDLOAD:MSG         1560
GRDLRGT             1620
GRDLRGT:COPY        1682
GRDLRGT:END         169A
GRDLRGT:FILTER      16C0
GRDLRGT:LOOP        166A
GRDLRGT:MSG         16A6
GRDMATR0            193C
GRDMATR1            213C
GRDMSHEI            1F
GRDMSWID            3F
GRDMUPD             1420
GRDNGEN             2940
GRDNPLR1            293C
GRDNPLR2            293E
GRDPLOT             16C6
GRDPLOT:LNHRZNTL    1716
GRDPLOT:LNVRTCL     16F8
GRDPXHEI            180
GRDPXWID            300
GRDRUPD             142A
GRDSAVE             1434
GRDSAVE:END         14B4
GRDSAVE:FILTER      14DA
GRDSAVE:LOOP        1482
GRDSAVE:LOOPY       147E
GRDSAVE:MSG         14C0
GRDSCNGX            30
GRDSCNGY            9
GRDSCP1X            2
GRDSCP1Y            9
GRDSCP2X            5E
GRDSCP2Y            9
GRDSHHEI            5
GRDSHWID            6
GRDSRC              1934
GRDSZCEL            C
GRDVEMRG            6E
GRDWIDTH            40
GRDXOFF             10
GRDYOFF             9E
MOUBITLF            0
MOUBITMD            2
MOUBITRT            1
MOUEDGE             18F5
MOUINIT             1020
MOUMSKLF            1
MOUMSKMD            4
MOUMSKRT            2
MOUREAD             1054
MOUTRAP             1
MOUVAL              18F4
MOUX                18F2
MOUY                18F0
SCRHEIGH            258
SCRINIT             107E
SCRTRAP             0
SCRUPD              10B6
SCRWIDTH            320
START               18D6
START:LOOP          18DE
SYSINIT             1000
UTLINIT             10D0
UTLRAND             10EA
UTLRAND:RANDVEC     1108
UTLRNDIX            18F6
UTLSTRLN            10D8
UTLSTRLN:END        10E6
UTLSTRLN:LOOP       10DC
